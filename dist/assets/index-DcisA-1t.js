(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const b of l.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&s(b)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();const a=document.getElementById("spiralCanvas"),i=a.getContext("2d");let B=3,c=2e4,f=100,D=[],m=!0,g=!1,u=!1,p=1,j=0,S=!1,h=2,v=2,N=!1,d=100;const T=200,oe=1,le=10,re=.25,M=[];let q=null;function W(){const t=document.getElementById("fullscreenToast");t.classList.add("show"),q&&clearTimeout(q),q=setTimeout(()=>{t.classList.remove("show")},3e3)}function ae(){const t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function ie(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function ue(){N?ie():ae()}function H(){const t=N;N=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const e=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");N?(e.style.display="none",n.style.display="none",s.style.display="none",t||W()):(e.style.display="flex",n.style.display="flex",s.style.display="flex",s.textContent="⛶",s.title="Toggle Fullscreen",document.getElementById("fullscreenToast").classList.remove("show"))}let I;const ce="SpiralPrefs",de=1,C="preferences";function me(){const t=indexedDB.open(ce,de);t.onerror=()=>console.warn("IndexedDB not available"),t.onsuccess=e=>{I=e.target.result,ge()},t.onupgradeneeded=e=>{I=e.target.result,I.createObjectStore(C,{keyPath:"id"})}}function r(t,e){if(!I)return;I.transaction([C],"readwrite").objectStore(C).put({id:t,value:e})}function ge(){if(!I)return;const e=I.transaction([C],"readonly").objectStore(C);e.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const s=document.getElementById("sidebar"),o=document.getElementById("sidebarToggle");n.target.result.value?(s.classList.add("collapsed"),o.textContent="☰"):o.textContent="✕"}else document.getElementById("sidebarToggle").textContent="✕"},e.get("spiralCoeff").onsuccess=n=>{n.target.result&&(f=n.target.result.value,document.getElementById("spiralSlider").value=f,document.getElementById("spiralNumber").value=f,y())},e.get("maxN").onsuccess=n=>{n.target.result&&(c=n.target.result.value,document.getElementById("maxNSlider").value=c,document.getElementById("maxNNumber").value=c,y())},e.get("clusterCount").onsuccess=n=>{n.target.result&&(d=n.target.result.value,document.getElementById("clusterCountSlider").value=d,document.getElementById("clusterCountNumber").value=d,z())},e.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){m=n.target.result.value;const s=document.getElementById("primeToggle");s.classList.toggle("active",m),s.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers"}},e.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){g=n.target.result.value;const s=document.getElementById("clusterToggle");s.classList.toggle("active",g),s.textContent=g?"Stop Animation":"Start Animation"}},e.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){u=n.target.result.value;const s=document.getElementById("rotationToggle");s.classList.toggle("active",u),s.textContent=u?"Stop Rotation":"Start Rotation"}},e.get("rotationSpeed").onsuccess=n=>{n.target.result&&(p=n.target.result.value,document.getElementById("rotationSpeedSlider").value=p,document.getElementById("rotationSpeedNumber").value=p)},e.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){S=n.target.result.value;const s=document.getElementById("shapeToggle");s.classList.toggle("active",S),s.textContent=S?"Use Circles":"Use Squares"}},e.get("dotSize").onsuccess=n=>{n.target.result&&(h=n.target.result.value,document.getElementById("dotSizeSlider").value=h,document.getElementById("dotSizeNumber").value=h)},e.get("primeSize").onsuccess=n=>{n.target.result&&(v=n.target.result.value,document.getElementById("primeSizeSlider").value=v,document.getElementById("primeSizeNumber").value=v)},e.get("scale").onsuccess=n=>{n.target.result&&(B=n.target.result.value,y())}}function fe(t){if(t<2)return!1;if(t===2)return!0;if(t%2===0)return!1;for(let e=3;e*e<=t;e+=2)if(t%e===0)return!1;return!0}function Y(){a.width=innerWidth,a.height=innerHeight,y(),z()}function y(){const t=a.width,e=a.height,n=t/2,s=e/2;D=[];const o=Math.min(c,2e6),b=Math.sqrt(t*t+e*e)/2;for(let E=1;E<=o;E++){const L=Math.sqrt(E)*B,w=f*Math.PI*Math.sqrt(E),x=n+L*Math.cos(w),P=s+L*Math.sin(w),F=u?b:0;x<-F||x>t+F||P<-F||P>e+F||D.push({x,y:P,n:E,isPrime:fe(E)})}c>o&&console.warn(`Capped point calculation at ${o} for performance`)}function z(){M.length=0;const t=a.width,e=a.height,n=Math.min(d,1e3);for(let s=0;s<n;s++){const o=Math.random()*t,l=Math.random()*e;M.push({x:o,y:l,targetX:Math.random()*t,targetY:Math.random()*e,speed:2+Math.random()*1})}d>n&&console.warn(`Capped cluster count at ${n} for performance`)}function pe(){const t=a.width,e=a.height;M.forEach(n=>{const s=n.targetX-n.x,o=n.targetY-n.y,l=Math.hypot(s,o);l<n.speed?(n.targetX=Math.random()*t,n.targetY=Math.random()*e):(n.x+=s/l*n.speed,n.y+=o/l*n.speed)})}function $(){g&&pe(),u&&(j+=p*.01),i.fillStyle=`rgba(0,0,0,${re})`,i.fillRect(0,0,a.width,a.height),i.save(),u&&(i.translate(a.width/2,a.height/2),i.rotate(j),i.translate(-a.width/2,-a.height/2));for(const t of D){let e=0;if(g)for(const l of M){const b=t.x-l.x,E=t.y-l.y;if(Math.abs(b)<T&&Math.abs(E)<T){const L=1-Math.abs(b)/T,w=1-Math.abs(E)/T,x=Math.min(L,w);e=Math.max(e,x)}}let n=h;m&&t.isPrime&&(n*=v);const s=n+e*oe,o=-e*le;m&&t.isPrime?i.fillStyle="#00ff00":i.fillStyle="#009900",S?i.fillRect(t.x-s/2,t.y+o-s/2,s,s):(i.beginPath(),i.arc(t.x,t.y+o,s/2,0,2*Math.PI),i.fill())}i.restore(),requestAnimationFrame($)}function he(t,e,n){return Math.max(e,Math.min(n,t))}window.addEventListener("wheel",t=>{t.preventDefault(),B=he(B*(t.deltaY>0?1.05:.95),2,200),r("scale",B),y()},{passive:!1});const ve=document.getElementById("sidebar");ve.addEventListener("wheel",t=>{t.stopPropagation()},{passive:!0});const ye=document.getElementById("fullscreenToggle");ye.addEventListener("click",ue);document.addEventListener("fullscreenchange",H);document.addEventListener("webkitfullscreenchange",H);document.addEventListener("msfullscreenchange",H);a.addEventListener("click",()=>{N&&W()});const Ee=document.getElementById("sidebar"),U=document.getElementById("sidebarToggle");U.addEventListener("click",()=>{const t=Ee.classList.toggle("collapsed");U.textContent=t?"☰":"✕",r("sidebarCollapsed",t)});const R=document.getElementById("primeToggle");R.addEventListener("click",()=>{m=!m,R.classList.toggle("active",m),R.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers",r("showPrimes",m)});const A=document.getElementById("clusterToggle");A.addEventListener("click",()=>{g=!g,A.classList.toggle("active",g),A.textContent=g?"Stop Animation":"Start Animation",r("showClusters",g)});const k=document.getElementById("rotationToggle");k.addEventListener("click",()=>{u=!u,k.classList.toggle("active",u),k.textContent=u?"Stop Rotation":"Start Rotation",r("showRotation",u),y()});const O=document.getElementById("shapeToggle");O.addEventListener("click",()=>{S=!S,O.classList.toggle("active",S),O.textContent=S?"Use Circles":"Use Squares",r("useSquares",S)});const X=document.getElementById("spiralSlider"),_=document.getElementById("spiralNumber");X.addEventListener("input",t=>{f=parseFloat(t.target.value),_.value=f,r("spiralCoeff",f),y()});_.addEventListener("input",t=>{const e=parseFloat(t.target.value);e>=0&&e<=2e3&&!isNaN(e)&&(f=e,e>=2&&e<=200&&(X.value=f),r("spiralCoeff",f),y())});const K=document.getElementById("maxNSlider"),V=document.getElementById("maxNNumber");K.addEventListener("input",t=>{c=parseInt(t.target.value),V.value=c,r("maxN",c),y()});V.addEventListener("input",t=>{const e=parseInt(t.target.value);e>=1&&e<=19e5&&!isNaN(e)&&(c=e,e>=2e4&&e<=19e4&&(K.value=c),e>5e5&&console.warn(`Warning: Using ${e} points may impact performance`),r("maxN",c),y())});const G=document.getElementById("clusterCountSlider"),J=document.getElementById("clusterCountNumber");G.addEventListener("input",t=>{d=parseInt(t.target.value),J.value=d,r("clusterCount",d),z()});J.addEventListener("input",t=>{const e=parseInt(t.target.value);e>=0&&e<=2e3&&!isNaN(e)&&(d=e,e>=100&&e<=200&&(G.value=d),e>500&&console.warn(`Warning: Using ${e} clusters may impact performance`),r("clusterCount",d),z())});const Q=document.getElementById("rotationSpeedSlider"),Z=document.getElementById("rotationSpeedNumber");Q.addEventListener("input",t=>{p=parseFloat(t.target.value),Z.value=p,r("rotationSpeed",p)});Z.addEventListener("input",t=>{const e=parseFloat(t.target.value);e>=.1&&e<=10&&!isNaN(e)&&(p=e,e>=.1&&e<=5&&(Q.value=p),r("rotationSpeed",p))});const ee=document.getElementById("dotSizeSlider"),te=document.getElementById("dotSizeNumber");ee.addEventListener("input",t=>{h=parseFloat(t.target.value),te.value=h,r("dotSize",h)});te.addEventListener("input",t=>{const e=parseFloat(t.target.value);e>=.1&&e<=20&&!isNaN(e)&&(h=e,e>=.5&&e<=10&&(ee.value=h),r("dotSize",h))});const ne=document.getElementById("primeSizeSlider"),se=document.getElementById("primeSizeNumber");ne.addEventListener("input",t=>{v=parseFloat(t.target.value),se.value=v,r("primeSize",v)});se.addEventListener("input",t=>{const e=parseFloat(t.target.value);e>=.1&&e<=10&&!isNaN(e)&&(v=e,e>=.5&&e<=5&&(ne.value=v),r("primeSize",v))});window.addEventListener("resize",Y);me();Y();requestAnimationFrame($);
