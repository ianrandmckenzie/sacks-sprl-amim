(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const u=document.getElementById("spiralCanvas"),c=u.getContext("2d");let k=5,E=5e3,x=2,I=[],v=!0,S=!0,f=!0,C=.1,te=0,b=!0,L=.1,N=10,g=!1,d=!1,T=100;const H=200,Ee=1,Ie=10,xe=.25,X=[];let G=null;function ie(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),G&&clearTimeout(G),G=setTimeout(()=>{e.classList.remove("show")},3e3)}async function ne(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else return}async function Q(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else return}async function se(){window.__TAURI__?(g=!g,g?await ne():await Q(),K(),r("isFullscreen",g)):g?await Q():await ne()}function K(){const e=g;window.__TAURI__||(g=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),o=document.getElementById("fullscreenToggle");g?(t.style.display="none",n.style.display="none",o.style.display="none",e||ie()):(t.style.display="flex",n.style.display="flex",o.style.display="flex",o.textContent="⛶",o.title="Toggle Fullscreen",document.getElementById("fullscreenToast").classList.remove("show"))}let B;const Te="SpiralPrefs",_e=1,F="preferences";function Ce(){const e=indexedDB.open(Te,_e);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{B=t.target.result,Le(),window.__TAURI__&&setTimeout(()=>{Z()},200)},e.onupgradeneeded=t=>{B=t.target.result,B.createObjectStore(F,{keyPath:"id"})}}function r(e,t){if(!B)return;B.transaction([F],"readwrite").objectStore(F).put({id:e,value:t})}async function J(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),n=await e.innerPosition(),o=await e.isMaximized();r("windowWidth",t.width),r("windowHeight",t.height),r("windowX",n.x),r("windowY",n.y),r("windowMaximized",o),r("isFullscreen",g),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:g})}catch(e){console.error("Failed to save window state:",e)}}async function Z(){if(!window.__TAURI__||!B){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(a=>setTimeout(a,100));const n=B.transaction([F],"readonly").objectStore(F),o=a=>new Promise(h=>{const l=n.get(a);l.onsuccess=()=>{var y;return h((y=l.result)==null?void 0:y.value)},l.onerror=()=>h(null)}),[i,s,m,z,p,w]=await Promise.all([o("windowWidth"),o("windowHeight"),o("windowX"),o("windowY"),o("windowMaximized"),o("isFullscreen")]);if(console.log("Loaded window state:",{width:i,height:s,x:m,y:z,maximized:p,fullscreen:w}),i&&s&&i>200&&s>200)try{await e.setSize(new window.__TAURI__.window.LogicalSize(i,s)),console.log("✅ Window size restored:",i,"x",s)}catch(a){console.error("❌ Failed to restore window size:",a)}else console.log("❌ No valid window size to restore");if(m!==null&&z!==null&&m>=-1e3&&z>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(m,z)),console.log("✅ Window position restored:",m,",",z)}catch(a){console.error("❌ Failed to restore window position:",a)}else console.log("❌ No valid window position to restore");if(p)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(a){console.error("❌ Failed to restore maximized state:",a)}w&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),g=!1,r("isFullscreen",!1))}catch(a){console.error("❌ Failed to restore fullscreen state:",a),g=!1,r("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function Le(){if(!B)return;const t=B.transaction([F],"readonly").objectStore(F);t.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const o=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle");n.target.result.value?(o.classList.add("collapsed"),i.textContent="☰",i.setAttribute("aria-expanded","false")):(i.textContent="✕",i.setAttribute("aria-expanded","true"))}else{const o=document.getElementById("sidebarToggle");o.textContent="✕",o.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=n=>{n.target.result&&(x=n.target.result.value,document.getElementById("spiralSlider").value=x,document.getElementById("spiralNumber").value=x,_())},t.get("maxN").onsuccess=n=>{n.target.result&&(E=n.target.result.value,document.getElementById("maxNSlider").value=E,document.getElementById("maxNNumber").value=E,_())},t.get("clusterCount").onsuccess=n=>{n.target.result&&(T=n.target.result.value,document.getElementById("clusterCountSlider").value=T,document.getElementById("clusterCountNumber").value=T,ee())},t.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){v=n.target.result.value;const o=document.getElementById("primeToggle");o.classList.toggle("active",v),o.setAttribute("aria-checked",v.toString()),o.textContent=v?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){S=n.target.result.value;const o=document.getElementById("clusterToggle");o.classList.toggle("active",S),o.setAttribute("aria-checked",S.toString()),o.textContent=S?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){f=n.target.result.value;const o=document.getElementById("rotationToggle");o.classList.toggle("active",f),o.setAttribute("aria-checked",f.toString()),o.textContent=f?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=n=>{n.target.result&&(C=n.target.result.value,document.getElementById("rotationSpeedSlider").value=C,document.getElementById("rotationSpeedNumber").value=C)},t.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){b=n.target.result.value;const o=document.getElementById("shapeToggle");o.classList.toggle("active",b),o.setAttribute("aria-checked",b.toString()),o.textContent=b?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=n=>{if(n.target.result!==void 0){d=n.target.result.value;const o=document.getElementById("instantRenderToggle");o.classList.toggle("active",d),o.setAttribute("aria-checked",d.toString()),o.textContent=d?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=n=>{n.target.result&&(L=n.target.result.value,document.getElementById("dotSizeSlider").value=L,document.getElementById("dotSizeNumber").value=L)},t.get("primeSize").onsuccess=n=>{n.target.result&&(N=n.target.result.value,document.getElementById("primeSizeSlider").value=N,document.getElementById("primeSizeNumber").value=N)},t.get("scale").onsuccess=n=>{n.target.result&&(k=n.target.result.value,_())}}const R=new Map;function oe(e){if(R.has(e))return R.get(e);if(e<2)return R.set(e,!1),!1;if(e===2)return R.set(e,!0),!0;if(e%2===0)return R.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return R.set(e,!1),!1;return R.set(e,!0),!0}function re(){u.width=window.innerWidth,u.height=window.innerHeight,_(),ee()}function _(){const e=u.width,t=u.height,n=e/2,o=t/2;I=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const i=Math.min(E,2e6),m=Math.sqrt(e*e+t*t)/2;if(d){for(let p=1;p<=i;p++){const w=Math.sqrt(p)*k,a=x*Math.PI*Math.sqrt(p),h=n+w*Math.cos(a),l=o+w*Math.sin(a),y=f?m:0;h<-y||h>e+y||l<-y||l>t+y||I.push({x:h,y:l,n:p,isPrime:oe(p)})}E>i&&console.warn(`Capped point calculation at ${i} for performance`)}else{let a=function(){const h=Math.min(w+1e3,i);for(let l=w;l<=h;l++){const y=Math.sqrt(l)*k,O=x*Math.PI*Math.sqrt(l),M=n+y*Math.cos(O),V=o+y*Math.sin(O),j=f?m:0;M<-j||M>e+j||V<-j||V>t+j||I.push({x:M,y:V,n:l,isPrime:oe(l)})}w=h+1,w<=i?window.currentComputationId=requestIdleCallback(a,{timeout:50}):(window.currentComputationId=null,E>i&&console.warn(`Capped point calculation at ${i} for performance`))};var z=a;let w=1;window.currentComputationId=requestIdleCallback(a,{timeout:50})}}function ee(){X.length=0;const e=u.width,t=u.height,n=Math.min(T,1e3);for(let o=0;o<n;o++){const i=Math.random()*e,s=Math.random()*t;X.push({x:i,y:s,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}T>n&&console.warn(`Capped cluster count at ${n} for performance`)}function Ne(){const e=u.width,t=u.height;X.forEach(n=>{const o=n.targetX-n.x,i=n.targetY-n.y,s=Math.hypot(o,i);s<n.speed?(n.targetX=Math.random()*e,n.targetY=Math.random()*t):(n.x+=o/s*n.speed,n.y+=i/s*n.speed)})}function ae(){S&&Ne(),f&&(te+=C*.01),c.fillStyle=`rgba(0,0,0,${xe})`,c.fillRect(0,0,u.width,u.height),c.save(),f&&(c.translate(u.width/2,u.height/2),c.rotate(te),c.translate(-u.width/2,-u.height/2));let e;d||I.length<=1e4?e=I.length:I.length<=5e4?e=Math.min(I.length,2e3):e=Math.min(I.length,5e3);const t=[],n=[];for(let o=0;o<e;o++){const i=I[o%I.length];let s=0;if(S)for(const a of X){const h=i.x-a.x,l=i.y-a.y;if(Math.abs(h)<H&&Math.abs(l)<H){const y=1-Math.abs(h)/H,O=1-Math.abs(l)/H,M=Math.min(y,O);s=Math.max(s,M)}}let m=L;v&&i.isPrime&&(m*=N);const z=m+s*Ee,p=-s*Ie,w={...i,size:z,offsetY:p};v&&i.isPrime?t.push(w):n.push(w)}n.length>0&&(c.fillStyle="#009900",n.forEach(o=>{b?c.fillRect(o.x-o.size/2,o.y+o.offsetY-o.size/2,o.size,o.size):(c.beginPath(),c.arc(o.x,o.y+o.offsetY,o.size/2,0,2*Math.PI),c.fill())})),t.length>0&&(c.fillStyle="#00ff00",t.forEach(o=>{b?c.fillRect(o.x-o.size/2,o.y+o.offsetY-o.size/2,o.size,o.size):(c.beginPath(),c.arc(o.x,o.y+o.offsetY,o.size/2,0,2*Math.PI),c.fill())})),c.restore(),requestAnimationFrame(ae)}function Be(e,t,n){return Math.max(t,Math.min(n,e))}const ze=$(e=>r("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),k=Be(k*(e.deltaY>0?1.05:.95),2,200),ze(k),d?_():Y()},{passive:!1});const Re=document.getElementById("sidebar");Re.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const Fe=document.getElementById("fullscreenToggle");Fe.addEventListener("click",se);document.addEventListener("fullscreenchange",K);document.addEventListener("webkitfullscreenchange",K);document.addEventListener("msfullscreenchange",K);u.addEventListener("click",()=>{g&&ie()});const le=document.getElementById("sidebar"),q=document.getElementById("sidebarToggle");q.addEventListener("click",()=>{const e=le.classList.toggle("collapsed");q.textContent=e?"☰":"✕",q.setAttribute("aria-expanded",(!e).toString()),r("sidebarCollapsed",e)});const A=document.getElementById("primeToggle");A.addEventListener("click",()=>{v=!v,A.classList.toggle("active",v),A.setAttribute("aria-checked",v.toString()),A.textContent=v?"Defocus Prime Numbers":"Focus Prime Numbers",r("showPrimes",v)});const P=document.getElementById("clusterToggle");P.addEventListener("click",()=>{S=!S,P.classList.toggle("active",S),P.setAttribute("aria-checked",S.toString()),P.textContent=S?"Stop Animation":"Start Animation",r("showClusters",S)});const W=document.getElementById("rotationToggle");W.addEventListener("click",()=>{f=!f,W.classList.toggle("active",f),W.setAttribute("aria-checked",f.toString()),W.textContent=f?"Stop Rotation":"Start Rotation",r("showRotation",f),_()});const U=document.getElementById("shapeToggle");U.addEventListener("click",()=>{b=!b,U.classList.toggle("active",b),U.setAttribute("aria-checked",b.toString()),U.textContent=b?"Use Circles":"Use Squares",r("useSquares",b)});const D=document.getElementById("instantRenderToggle");D.addEventListener("click",()=>{d=!d,D.classList.toggle("active",d),D.setAttribute("aria-checked",d.toString()),D.textContent=d?"Disable Instant Render":"Enable Instant Render",r("instantRender",d)});function $(e,t){let n;return function(...i){const s=()=>{clearTimeout(n),e(...i)};clearTimeout(n),n=setTimeout(s,t)}}const Y=$(_,100),ce=$(ee,100),de=document.getElementById("spiralSlider"),ue=document.getElementById("spiralNumber");de.addEventListener("input",e=>{x=parseFloat(e.target.value),ue.value=x,r("spiralCoeff",x),d?_():Y()});ue.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(x=t,t>=2&&t<=200&&(de.value=x),r("spiralCoeff",x),d?_():Y())});const ge=document.getElementById("maxNSlider"),me=document.getElementById("maxNNumber");ge.addEventListener("input",e=>{E=parseInt(e.target.value),me.value=E,r("maxN",E),d?_():Y()});me.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(E=t,t>=2e4&&t<=19e4&&(ge.value=E),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),r("maxN",E),d?_():Y())});const fe=document.getElementById("clusterCountSlider"),we=document.getElementById("clusterCountNumber");fe.addEventListener("input",e=>{T=parseInt(e.target.value),we.value=T,r("clusterCount",T),ce()});we.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(T=t,t>=100&&t<=200&&(fe.value=T),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),r("clusterCount",T),ce())});const pe=document.getElementById("rotationSpeedSlider"),he=document.getElementById("rotationSpeedNumber");pe.addEventListener("input",e=>{C=parseFloat(e.target.value),he.value=C,r("rotationSpeed",C)});he.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(C=t,t>=.1&&t<=5&&(pe.value=C),r("rotationSpeed",C))});const ye=document.getElementById("dotSizeSlider"),ve=document.getElementById("dotSizeNumber");ye.addEventListener("input",e=>{L=parseFloat(e.target.value),ve.value=L,r("dotSize",L)});ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(L=t,t>=.5&&t<=10&&(ye.value=L),r("dotSize",L))});const Se=document.getElementById("primeSizeSlider"),be=document.getElementById("primeSizeNumber");Se.addEventListener("input",e=>{N=parseFloat(e.target.value),be.value=N,r("primeSize",N)});be.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(N=t,t>=.5&&t<=5&&(Se.value=N),r("primeSize",N))});document.addEventListener("keydown",e=>{e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||(e.key==="Escape"&&(g?(g=!1,Q(),K(),window.__TAURI__&&r("isFullscreen",g)):le.classList.contains("collapsed")||q.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),se()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),q.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),A.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),P.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),W.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),U.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),D.click()))});window.addEventListener("resize",re);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),Z()},500)});if(window.__TAURI__){const e=$(J,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{J()}),window.debugSaveWindowState=J,window.debugLoadWindowState=Z,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}Ce();re();requestAnimationFrame(ae);
