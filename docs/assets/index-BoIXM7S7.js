(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const s=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-s))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const g=document.getElementById("spiralCanvas"),u=g.getContext("2d");let q=5,x=5e3,C=2,T=[],E=!0,S=!0,w=!0,B=.1,re=0,I=!0,L=.1,N=10,r=!1,h=!1,se=!0,d=!1,f=!1,F=100;const G=200,Fe=1,_e=10,Be=.25,Z=[];let z=null;function oe(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),z&&clearTimeout(z),z=setTimeout(()=>{e.classList.remove("show")},3e3)}async function ae(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else{const e=document.documentElement;try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}}async function ee(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}}async function J(){console.log("Showing interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");e.style.display="flex",t.style.display="flex",s.style.display="flex";const n=document.getElementById("fullscreenToast");n.textContent="Interface restored - Use macOS fullscreen controls to exit, or ESC to hide interface",n.classList.add("show"),z&&clearTimeout(z),z=setTimeout(()=>{n.classList.remove("show"),n.textContent="Press ESC to exit fullscreen"},4e3)}function Q(){console.log("Hiding interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");e.style.display="none",t.style.display="none",s.style.display="none";const n=document.getElementById("fullscreenToast");n.textContent="Interface hidden - Press ESC to show interface",n.classList.add("show"),z&&clearTimeout(z),z=setTimeout(()=>{n.classList.remove("show")},3e3)}async function de(){if(window.__TAURI__)r?h?(console.log("Toggling interface visibility instead of exiting fullscreen (was fullscreen before)"),d?(Q(),d=!1):(J(),d=!0)):(console.log("Exiting fullscreen (was not fullscreen before)"),r=!1,h=!1,se=!0,d=!1,await ee(),P(),l("isFullscreen",r),setTimeout(()=>{A()},500)):(console.log("Entering fullscreen (was fullscreen before:",r,")"),h=r,r=!0,se=!0,d=!1,await ae(),P(),l("isFullscreen",r));else if(!r)h=r,await ae();else if(h){oe();return}else await ee(),h=!1,d=!1,setTimeout(()=>{A()},500)}function P(){const e=r;window.__TAURI__||(r=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),s=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle");if(r){if(t.style.display="none",s.style.display="none",n.style.display="none",!e){const o=document.getElementById("fullscreenToast");h?o.textContent="Fullscreen mode - Press ESC to toggle menu":o.textContent="Fullscreen mode - Press ESC to exit fullscreen",oe()}}else{t.style.display="flex",s.style.display="flex",n.style.display="flex",n.textContent="⛶",n.title="Toggle Fullscreen";const o=document.getElementById("fullscreenToast");o.classList.remove("show"),o.textContent="Press ESC to exit fullscreen"}}let R;const Le="SpiralPrefs",Ne=1,W="preferences";function ze(){const e=indexedDB.open(Le,Ne);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{R=t.target.result,Re(),window.__TAURI__&&setTimeout(()=>{ie()},200)},e.onupgradeneeded=t=>{R=t.target.result,R.createObjectStore(W,{keyPath:"id"})}}function l(e,t){if(!R)return;R.transaction([W],"readwrite").objectStore(W).put({id:e,value:t})}async function A(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),s=await e.innerPosition(),n=await e.isMaximized();r?console.log("Skipping window size save (in fullscreen mode)"):(l("windowWidth",t.width),l("windowHeight",t.height),l("windowX",s.x),l("windowY",s.y),l("windowMaximized",n),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:r})),l("isFullscreen",r)}catch(e){console.error("Failed to save window state:",e)}}async function ie(){if(!window.__TAURI__||!R){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(a=>setTimeout(a,100));const s=R.transaction([W],"readonly").objectStore(W),n=a=>new Promise(p=>{const c=s.get(a);c.onsuccess=()=>{var v;return p((v=c.result)==null?void 0:v.value)},c.onerror=()=>p(null)}),[o,i,m,k,b,y]=await Promise.all([n("windowWidth"),n("windowHeight"),n("windowX"),n("windowY"),n("windowMaximized"),n("isFullscreen")]);if(console.log("Loaded window state:",{width:o,height:i,x:m,y:k,maximized:b,fullscreen:y}),o&&i&&o>200&&i>200)if(o<=3840&&i<=2160)try{await e.setSize(new window.__TAURI__.window.LogicalSize(o,i)),console.log("✅ Window size restored:",o,"x",i)}catch(c){console.error("❌ Failed to restore window size:",c)}else console.log("❌ Saved window size too large, skipping restore:",o,"x",i),l("windowWidth",null),l("windowHeight",null);else console.log("❌ No valid window size to restore");if(m!==null&&k!==null&&m>=-1e3&&k>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(m,k)),console.log("✅ Window position restored:",m,",",k)}catch(a){console.error("❌ Failed to restore window position:",a)}else console.log("❌ No valid window position to restore");if(b)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(a){console.error("❌ Failed to restore maximized state:",a)}y&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),r=!1,h=!1,d=!1,l("isFullscreen",!1))}catch(a){console.error("❌ Failed to restore fullscreen state:",a),r=!1,h=!1,d=!1,l("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function Re(){if(!R)return;const t=R.transaction([W],"readonly").objectStore(W);t.get("sidebarCollapsed").onsuccess=s=>{if(s.target.result){const n=document.getElementById("sidebar"),o=document.getElementById("sidebarToggle");s.target.result.value?(n.classList.add("collapsed"),o.textContent="☰",o.setAttribute("aria-expanded","false")):(o.textContent="✕",o.setAttribute("aria-expanded","true"))}else{const n=document.getElementById("sidebarToggle");n.textContent="✕",n.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=s=>{s.target.result&&(C=s.target.result.value,document.getElementById("spiralSlider").value=C,document.getElementById("spiralNumber").value=C,_())},t.get("maxN").onsuccess=s=>{s.target.result&&(x=s.target.result.value,document.getElementById("maxNSlider").value=x,document.getElementById("maxNNumber").value=x,_())},t.get("clusterCount").onsuccess=s=>{s.target.result&&(F=s.target.result.value,document.getElementById("clusterCountSlider").value=F,document.getElementById("clusterCountNumber").value=F,le())},t.get("showPrimes").onsuccess=s=>{if(s.target.result!==void 0){E=s.target.result.value;const n=document.getElementById("primeToggle");n.classList.toggle("active",E),n.setAttribute("aria-checked",E.toString()),n.textContent=E?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=s=>{if(s.target.result!==void 0){S=s.target.result.value;const n=document.getElementById("clusterToggle");n.classList.toggle("active",S),n.setAttribute("aria-checked",S.toString()),n.textContent=S?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=s=>{if(s.target.result!==void 0){w=s.target.result.value;const n=document.getElementById("rotationToggle");n.classList.toggle("active",w),n.setAttribute("aria-checked",w.toString()),n.textContent=w?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=s=>{s.target.result&&(B=s.target.result.value,document.getElementById("rotationSpeedSlider").value=B,document.getElementById("rotationSpeedNumber").value=B)},t.get("useSquares").onsuccess=s=>{if(s.target.result!==void 0){I=s.target.result.value;const n=document.getElementById("shapeToggle");n.classList.toggle("active",I),n.setAttribute("aria-checked",I.toString()),n.textContent=I?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=s=>{if(s.target.result!==void 0){f=s.target.result.value;const n=document.getElementById("instantRenderToggle");n.classList.toggle("active",f),n.setAttribute("aria-checked",f.toString()),n.textContent=f?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=s=>{s.target.result&&(L=s.target.result.value,document.getElementById("dotSizeSlider").value=L,document.getElementById("dotSizeNumber").value=L)},t.get("primeSize").onsuccess=s=>{s.target.result&&(N=s.target.result.value,document.getElementById("primeSizeSlider").value=N,document.getElementById("primeSizeNumber").value=N)},t.get("scale").onsuccess=s=>{s.target.result&&(q=s.target.result.value,_())}}const M=new Map;function ce(e){if(M.has(e))return M.get(e);if(e<2)return M.set(e,!1),!1;if(e===2)return M.set(e,!0),!0;if(e%2===0)return M.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return M.set(e,!1),!1;return M.set(e,!0),!0}function ue(){g.width=window.innerWidth,g.height=window.innerHeight,_(),le()}function _(){const e=g.width,t=g.height,s=e/2,n=t/2;T=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const o=Math.min(x,2e6),m=Math.sqrt(e*e+t*t)/2;if(f){for(let b=1;b<=o;b++){const y=Math.sqrt(b)*q,a=C*Math.PI*Math.sqrt(b),p=s+y*Math.cos(a),c=n+y*Math.sin(a),v=w?m:0;p<-v||p>e+v||c<-v||c>t+v||T.push({x:p,y:c,n:b,isPrime:ce(b)})}x>o&&console.warn(`Capped point calculation at ${o} for performance`)}else{let a=function(){const p=Math.min(y+1e3,o);for(let c=y;c<=p;c++){const v=Math.sqrt(c)*q,$=C*Math.PI*Math.sqrt(c),U=s+v*Math.cos($),ne=n+v*Math.sin($),V=w?m:0;U<-V||U>e+V||ne<-V||ne>t+V||T.push({x:U,y:ne,n:c,isPrime:ce(c)})}y=p+1,y<=o?window.currentComputationId=requestIdleCallback(a,{timeout:50}):(window.currentComputationId=null,x>o&&console.warn(`Capped point calculation at ${o} for performance`))};var k=a;let y=1;window.currentComputationId=requestIdleCallback(a,{timeout:50})}}function le(){Z.length=0;const e=g.width,t=g.height,s=Math.min(F,1e3);for(let n=0;n<s;n++){const o=Math.random()*e,i=Math.random()*t;Z.push({x:o,y:i,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}F>s&&console.warn(`Capped cluster count at ${s} for performance`)}function ke(){const e=g.width,t=g.height;Z.forEach(s=>{const n=s.targetX-s.x,o=s.targetY-s.y,i=Math.hypot(n,o);i<s.speed?(s.targetX=Math.random()*e,s.targetY=Math.random()*t):(s.x+=n/i*s.speed,s.y+=o/i*s.speed)})}function fe(){S&&ke(),w&&(re+=B*.01),u.fillStyle=`rgba(0,0,0,${Be})`,u.fillRect(0,0,g.width,g.height),u.save(),w&&(u.translate(g.width/2,g.height/2),u.rotate(re),u.translate(-g.width/2,-g.height/2));let e;f||T.length<=1e4?e=T.length:T.length<=5e4?e=Math.min(T.length,2e3):e=Math.min(T.length,5e3);const t=[],s=[];for(let n=0;n<e;n++){const o=T[n%T.length];let i=0;if(S)for(const a of Z){const p=o.x-a.x,c=o.y-a.y;if(Math.abs(p)<G&&Math.abs(c)<G){const v=1-Math.abs(p)/G,$=1-Math.abs(c)/G,U=Math.min(v,$);i=Math.max(i,U)}}let m=L;E&&o.isPrime&&(m*=N);const k=m+i*Fe,b=-i*_e,y={...o,size:k,offsetY:b};E&&o.isPrime?t.push(y):s.push(y)}s.length>0&&(u.fillStyle="#009900",s.forEach(n=>{I?u.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(u.beginPath(),u.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),u.fill())})),t.length>0&&(u.fillStyle="#00ff00",t.forEach(n=>{I?u.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(u.beginPath(),u.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),u.fill())})),u.restore(),requestAnimationFrame(fe)}function Me(e,t,s){return Math.max(t,Math.min(s,e))}const Ae=te(e=>l("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),q=Me(q*(e.deltaY>0?1.05:.95),2,200),Ae(q),f?_():X()},{passive:!1});const Pe=document.getElementById("sidebar");Pe.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const We=document.getElementById("fullscreenToggle");We.addEventListener("click",de);document.addEventListener("fullscreenchange",P);document.addEventListener("webkitfullscreenchange",P);document.addEventListener("msfullscreenchange",P);g.addEventListener("click",()=>{r&&oe()});const ge=document.getElementById("sidebar"),j=document.getElementById("sidebarToggle");j.addEventListener("click",()=>{const e=ge.classList.toggle("collapsed");j.textContent=e?"☰":"✕",j.setAttribute("aria-expanded",(!e).toString()),l("sidebarCollapsed",e)});const D=document.getElementById("primeToggle");D.addEventListener("click",()=>{E=!E,D.classList.toggle("active",E),D.setAttribute("aria-checked",E.toString()),D.textContent=E?"Defocus Prime Numbers":"Focus Prime Numbers",l("showPrimes",E)});const K=document.getElementById("clusterToggle");K.addEventListener("click",()=>{S=!S,K.classList.toggle("active",S),K.setAttribute("aria-checked",S.toString()),K.textContent=S?"Stop Animation":"Start Animation",l("showClusters",S)});const H=document.getElementById("rotationToggle");H.addEventListener("click",()=>{w=!w,H.classList.toggle("active",w),H.setAttribute("aria-checked",w.toString()),H.textContent=w?"Stop Rotation":"Start Rotation",l("showRotation",w),_()});const Y=document.getElementById("shapeToggle");Y.addEventListener("click",()=>{I=!I,Y.classList.toggle("active",I),Y.setAttribute("aria-checked",I.toString()),Y.textContent=I?"Use Circles":"Use Squares",l("useSquares",I)});const O=document.getElementById("instantRenderToggle");O.addEventListener("click",()=>{f=!f,O.classList.toggle("active",f),O.setAttribute("aria-checked",f.toString()),O.textContent=f?"Disable Instant Render":"Enable Instant Render",l("instantRender",f)});function te(e,t){let s;return function(...o){const i=()=>{clearTimeout(s),e(...o)};clearTimeout(s),s=setTimeout(i,t)}}const X=te(_,100),me=te(le,100),we=document.getElementById("spiralSlider"),he=document.getElementById("spiralNumber");we.addEventListener("input",e=>{C=parseFloat(e.target.value),he.value=C,l("spiralCoeff",C),f?_():X()});he.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(C=t,t>=2&&t<=200&&(we.value=C),l("spiralCoeff",C),f?_():X())});const ye=document.getElementById("maxNSlider"),pe=document.getElementById("maxNNumber");ye.addEventListener("input",e=>{x=parseInt(e.target.value),pe.value=x,l("maxN",x),f?_():X()});pe.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(x=t,t>=2e4&&t<=19e4&&(ye.value=x),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),l("maxN",x),f?_():X())});const be=document.getElementById("clusterCountSlider"),ve=document.getElementById("clusterCountNumber");be.addEventListener("input",e=>{F=parseInt(e.target.value),ve.value=F,l("clusterCount",F),me()});ve.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(F=t,t>=100&&t<=200&&(be.value=F),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),l("clusterCount",F),me())});const Ee=document.getElementById("rotationSpeedSlider"),Se=document.getElementById("rotationSpeedNumber");Ee.addEventListener("input",e=>{B=parseFloat(e.target.value),Se.value=B,l("rotationSpeed",B)});Se.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(B=t,t>=.1&&t<=5&&(Ee.value=B),l("rotationSpeed",B))});const Ie=document.getElementById("dotSizeSlider"),xe=document.getElementById("dotSizeNumber");Ie.addEventListener("input",e=>{L=parseFloat(e.target.value),xe.value=L,l("dotSize",L)});xe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(L=t,t>=.5&&t<=10&&(Ie.value=L),l("dotSize",L))});const Te=document.getElementById("primeSizeSlider"),Ce=document.getElementById("primeSizeNumber");Te.addEventListener("input",e=>{N=parseFloat(e.target.value),Ce.value=N,l("primeSize",N)});Ce.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(N=t,t>=.5&&t<=5&&(Te.value=N),l("primeSize",N))});document.addEventListener("keydown",e=>{e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||(e.key==="Escape"&&(r?window.__TAURI__?h?(console.log("ESC: Toggling interface visibility in fullscreen (was fullscreen before)"),d?(Q(),d=!1):(J(),d=!0)):(console.log("ESC: Exiting fullscreen"),r=!1,h=!1,se=!0,d=!1,ee(),P(),l("isFullscreen",r),setTimeout(()=>{A()},500)):h?d?(Q(),d=!1):(J(),d=!0):(r=!1,ee(),P(),h=!1,d=!1,setTimeout(()=>{A()},500)):ge.classList.contains("collapsed")||j.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),r&&h?(console.log("F key: Toggling interface visibility in fullscreen (was fullscreen before)"),d?(Q(),d=!1):(J(),d=!0)):de()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),j.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),D.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),K.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),H.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),Y.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),O.click()))});window.addEventListener("resize",ue);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),ie()},500)});if(window.__TAURI__){const e=te(A,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{A()}),window.debugSaveWindowState=A,window.debugLoadWindowState=ie,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}ze();ue();requestAnimationFrame(fe);
