(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const i=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-i))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const E=document.getElementById("spiralCanvas"),w=E.getContext("2d");let V=5,M=5e3,c=2,k=[],C=!0,L=!0,S=!0,W=.1,Ie=0,F=!0,q=.1,D=10,d=!1,x=!1,ye=!0,p=!1,y=!1,h=!1,R=100,I=.1,a=1,r=500,Se=1,te=null,_=null,ce=!1;const Ze=2e3;let z=100;const le=200,et=1,tt=10,nt=.25,de=[];function it(){d&&!ce&&(document.body.style.cursor="none",ce=!0)}function fe(){ce&&(document.body.style.cursor="auto",ce=!1)}function O(){_&&clearTimeout(_),d&&(fe(),_=setTimeout(it,Ze))}let U=null;function ve(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),U&&clearTimeout(U),U=setTimeout(()=>{e.classList.remove("show")},3e3)}async function xe(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else{const e=document.documentElement;try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}O()}async function ue(){if(_&&(clearTimeout(_),_=null),fe(),window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}}async function ae(){console.log("Showing interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="flex",t.style.display="flex",i.style.display="flex",_&&(clearTimeout(_),_=null),fe();const n=document.getElementById("fullscreenToast");n.textContent="Interface restored - Use macOS fullscreen controls to exit, or ESC to hide interface",n.classList.add("show"),U&&clearTimeout(U),U=setTimeout(()=>{n.classList.remove("show"),n.textContent="Press ESC to exit fullscreen"},4e3)}function re(){console.log("Hiding interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="none",t.style.display="none",i.style.display="none",O();const n=document.getElementById("fullscreenToast");n.textContent="Interface hidden - Press ESC to show interface",n.classList.add("show"),U&&clearTimeout(U),U=setTimeout(()=>{n.classList.remove("show")},3e3)}async function Be(){if(window.__TAURI__)d?x?(console.log("Toggling interface visibility instead of exiting fullscreen (was fullscreen before)"),p?(re(),p=!1):(ae(),p=!0)):(console.log("Exiting fullscreen (was not fullscreen before)"),d=!1,x=!1,ye=!0,p=!1,await ue(),Y(),s("isFullscreen",d),setTimeout(()=>{j()},500)):(console.log("Entering fullscreen (was fullscreen before:",d,")"),x=d,d=!0,ye=!0,p=!1,await xe(),Y(),s("isFullscreen",d));else if(!d)x=d,await xe();else if(x){ve();return}else await ue(),x=!1,p=!1,setTimeout(()=>{j()},500)}function Y(){const e=d;window.__TAURI__||(d=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle");if(d){if(t.style.display="none",i.style.display="none",n.style.display="none",e||O(),!e){const o=document.getElementById("fullscreenToast");x?o.textContent="Fullscreen mode - Press ESC to toggle menu":o.textContent="Fullscreen mode - Press ESC to exit fullscreen",ve()}}else{t.style.display="flex",i.style.display="flex",n.style.display="flex",n.textContent="⛶",n.title="Toggle Fullscreen",e&&(_&&(clearTimeout(_),_=null),fe());const o=document.getElementById("fullscreenToast");o.classList.remove("show"),o.textContent="Press ESC to exit fullscreen"}}let N;const ot="SpiralPrefs",st=1,P="preferences";function lt(){const e=indexedDB.open(ot,st);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{N=t.target.result,at(),window.__TAURI__&&setTimeout(()=>{he()},200)},e.onupgradeneeded=t=>{N=t.target.result,N.createObjectStore(P,{keyPath:"id"})}}function s(e,t){if(!N)return;N.transaction([P],"readwrite").objectStore(P).put({id:e,value:t})}async function j(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),i=await e.innerPosition(),n=await e.isMaximized();d?console.log("Skipping window size save (in fullscreen mode)"):(s("windowWidth",t.width),s("windowHeight",t.height),s("windowX",i.x),s("windowY",i.y),s("windowMaximized",n),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:d})),s("isFullscreen",d)}catch(e){console.error("Failed to save window state:",e)}}async function he(){if(!window.__TAURI__||!N){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(m=>setTimeout(m,100));const i=N.transaction([P],"readonly").objectStore(P),n=m=>new Promise(A=>{const g=i.get(m);g.onsuccess=()=>{var B;return A((B=g.result)==null?void 0:B.value)},g.onerror=()=>A(null)}),[o,l,u,f,v,b]=await Promise.all([n("windowWidth"),n("windowHeight"),n("windowX"),n("windowY"),n("windowMaximized"),n("isFullscreen")]);if(console.log("Loaded window state:",{width:o,height:l,x:u,y:f,maximized:v,fullscreen:b}),o&&l&&o>200&&l>200)if(o<=3840&&l<=2160)try{await e.setSize(new window.__TAURI__.window.LogicalSize(o,l)),console.log("✅ Window size restored:",o,"x",l)}catch(g){console.error("❌ Failed to restore window size:",g)}else console.log("❌ Saved window size too large, skipping restore:",o,"x",l),s("windowWidth",null),s("windowHeight",null);else console.log("❌ No valid window size to restore");if(u!==null&&f!==null&&u>=-1e3&&f>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(u,f)),console.log("✅ Window position restored:",u,",",f)}catch(m){console.error("❌ Failed to restore window position:",m)}else console.log("❌ No valid window position to restore");if(v)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(m){console.error("❌ Failed to restore maximized state:",m)}b&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),d=!1,x=!1,p=!1,s("isFullscreen",!1))}catch(m){console.error("❌ Failed to restore fullscreen state:",m),d=!1,x=!1,p=!1,s("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function at(){if(!N)return;const t=N.transaction([P],"readonly").objectStore(P);t.get("sidebarCollapsed").onsuccess=i=>{if(i.target.result){const n=document.getElementById("sidebar"),o=document.getElementById("sidebarToggle");i.target.result.value?(n.classList.add("collapsed"),o.textContent="☰",o.setAttribute("aria-expanded","false")):(o.textContent="✕",o.setAttribute("aria-expanded","true"))}else{const n=document.getElementById("sidebarToggle");n.textContent="✕",n.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(c=n,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,T()):(console.warn("Invalid spiralCoeff value loaded, resetting to default (2)"),c=2,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,s("spiralCoeff",c),T())}},t.get("maxN").onsuccess=i=>{i.target.result&&(M=i.target.result.value,document.getElementById("maxNSlider").value=M,document.getElementById("maxNNumber").value=M,T())},t.get("clusterCount").onsuccess=i=>{i.target.result&&(z=i.target.result.value,document.getElementById("clusterCountSlider").value=z,document.getElementById("clusterCountNumber").value=z,Ee())},t.get("showPrimes").onsuccess=i=>{if(i.target.result!==void 0){C=i.target.result.value;const n=document.getElementById("primeToggle");n.classList.toggle("active",C),n.setAttribute("aria-checked",C.toString()),n.textContent=C?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=i=>{if(i.target.result!==void 0){L=i.target.result.value;const n=document.getElementById("clusterToggle");n.classList.toggle("active",L),n.setAttribute("aria-checked",L.toString()),n.textContent=L?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=i=>{if(i.target.result!==void 0){S=i.target.result.value;const n=document.getElementById("rotationToggle");n.classList.toggle("active",S),n.setAttribute("aria-checked",S.toString()),n.textContent=S?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=i=>{i.target.result&&(W=i.target.result.value,document.getElementById("rotationSpeedSlider").value=W,document.getElementById("rotationSpeedNumber").value=W)},t.get("useSquares").onsuccess=i=>{if(i.target.result!==void 0){F=i.target.result.value;const n=document.getElementById("shapeToggle");n.classList.toggle("active",F),n.setAttribute("aria-checked",F.toString()),n.textContent=F?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=i=>{if(i.target.result!==void 0){y=i.target.result.value;const n=document.getElementById("instantRenderToggle");n.classList.toggle("active",y),n.setAttribute("aria-checked",y.toString()),n.textContent=y?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=i=>{i.target.result&&(q=i.target.result.value,document.getElementById("dotSizeSlider").value=q,document.getElementById("dotSizeNumber").value=q)},t.get("primeSize").onsuccess=i=>{i.target.result&&(D=i.target.result.value,document.getElementById("primeSizeSlider").value=D,document.getElementById("primeSizeNumber").value=D)},t.get("scale").onsuccess=i=>{i.target.result&&(V=i.target.result.value,T())},t.get("animateSpiralCoeff").onsuccess=i=>{if(i.target.result!==void 0){h=i.target.result.value;const n=document.getElementById("spiralAnimationToggle");n.classList.toggle("active",h),n.setAttribute("aria-checked",h.toString()),n.textContent=h?"Stop Spiral Animation":"Animate Spiral Coefficient";const o=document.getElementById("spiralAnimationControls");o.style.display=h?"block":"none",h&&ge()}},t.get("spiralAnimationSpeed").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseInt(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>=10&&n<=2e3?(R=n,document.getElementById("spiralAnimationSpeedSlider").value=R,document.getElementById("spiralAnimationSpeedNumber").value=R):(console.warn("Invalid spiralAnimationSpeed value, using default (100)"),R=100)}},t.get("spiralAnimationIncrement").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0&&n<=10?(I=n,document.getElementById("spiralAnimationIncrementSlider").value=I,document.getElementById("spiralAnimationIncrementNumber").value=I):(console.warn("Invalid spiralAnimationIncrement value, using default (0.1)"),I=.1)}},t.get("spiralAnimationMin").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(a=n,document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a):(console.warn("Invalid spiralAnimationMin value, using default (1)"),a=1)}},t.get("spiralAnimationMax").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>a?(r=n,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r):(console.warn("Invalid spiralAnimationMax value, using default (500)"),r=500)}}}const H=new Map;function Ae(e){if(H.has(e))return H.get(e);if(e<2)return H.set(e,!1),!1;if(e===2)return H.set(e,!0),!0;if(e%2===0)return H.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return H.set(e,!1),!1;return H.set(e,!0),!0}function Ce(){E.width=window.innerWidth,E.height=window.innerHeight,T(),Ee()}function T(){const e=E.width,t=E.height,i=e/2,n=t/2;k=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const o=Math.min(M,2e6),u=Math.sqrt(e*e+t*t)/2;if(y){for(let v=1;v<=o;v++){const b=Math.sqrt(v)*V,m=c*Math.PI*Math.sqrt(v),A=i+b*Math.cos(m),g=n+b*Math.sin(m),B=S?u:0;A<-B||A>e+B||g<-B||g>t+B||k.push({x:A,y:g,n:v,isPrime:Ae(v)})}M>o&&console.warn(`Capped point calculation at ${o} for performance`)}else{let m=function(){const A=Math.min(b+1e3,o);for(let g=b;g<=A;g++){const B=Math.sqrt(g)*V,oe=c*Math.PI*Math.sqrt(g),X=i+B*Math.cos(oe),we=n+B*Math.sin(oe),se=S?u:0;X<-se||X>e+se||we<-se||we>t+se||k.push({x:X,y:we,n:g,isPrime:Ae(g)})}b=A+1,b<=o?window.currentComputationId=requestIdleCallback(m,{timeout:50}):(window.currentComputationId=null,M>o&&console.warn(`Capped point calculation at ${o} for performance`))};var f=m;let b=1;window.currentComputationId=requestIdleCallback(m,{timeout:50})}}function Ee(){de.length=0;const e=E.width,t=E.height,i=Math.min(z,1e3);for(let n=0;n<i;n++){const o=Math.random()*e,l=Math.random()*t;de.push({x:o,y:l,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}z>i&&console.warn(`Capped cluster count at ${i} for performance`)}function rt(){const e=E.width,t=E.height;de.forEach(i=>{const n=i.targetX-i.x,o=i.targetY-i.y,l=Math.hypot(n,o);l<i.speed?(i.targetX=Math.random()*e,i.targetY=Math.random()*t):(i.x+=n/l*i.speed,i.y+=o/l*i.speed)})}function Le(){L&&rt(),S&&(Ie+=W*.01),w.fillStyle=`rgba(0,0,0,${nt})`,w.fillRect(0,0,E.width,E.height),w.save(),S&&(w.translate(E.width/2,E.height/2),w.rotate(Ie),w.translate(-E.width/2,-E.height/2));let e;y||k.length<=1e4?e=k.length:k.length<=5e4?e=Math.min(k.length,2e3):e=Math.min(k.length,5e3);const t=[],i=[];for(let n=0;n<e;n++){const o=k[n%k.length];let l=0;if(L)for(const m of de){const A=o.x-m.x,g=o.y-m.y;if(Math.abs(A)<le&&Math.abs(g)<le){const B=1-Math.abs(A)/le,oe=1-Math.abs(g)/le,X=Math.min(B,oe);l=Math.max(l,X)}}let u=q;C&&o.isPrime&&(u*=D);const f=u+l*et,v=-l*tt,b={...o,size:f,offsetY:v};C&&o.isPrime?t.push(b):i.push(b)}i.length>0&&(w.fillStyle="#009900",i.forEach(n=>{F?w.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(w.beginPath(),w.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),w.fill())})),t.length>0&&(w.fillStyle="#00ff00",t.forEach(n=>{F?w.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(w.beginPath(),w.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),w.fill())})),w.restore(),requestAnimationFrame(Le)}const ct=pe(e=>s("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),V=me(V*(e.deltaY>0?1.05:.95),2,200),ct(V),y?T():ie()},{passive:!1});const dt=document.getElementById("sidebar");dt.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const ut=document.getElementById("fullscreenToggle");ut.addEventListener("click",Be);document.addEventListener("fullscreenchange",Y);document.addEventListener("webkitfullscreenchange",Y);document.addEventListener("msfullscreenchange",Y);E.addEventListener("click",()=>{d&&ve()});const Fe=document.getElementById("sidebar"),ne=document.getElementById("sidebarToggle");ne.addEventListener("click",()=>{const e=Fe.classList.toggle("collapsed");ne.textContent=e?"☰":"✕",ne.setAttribute("aria-expanded",(!e).toString()),s("sidebarCollapsed",e)});const $=document.getElementById("primeToggle");$.addEventListener("click",()=>{C=!C,$.classList.toggle("active",C),$.setAttribute("aria-checked",C.toString()),$.textContent=C?"Defocus Prime Numbers":"Focus Prime Numbers",s("showPrimes",C)});const G=document.getElementById("clusterToggle");G.addEventListener("click",()=>{L=!L,G.classList.toggle("active",L),G.setAttribute("aria-checked",L.toString()),G.textContent=L?"Stop Animation":"Start Animation",s("showClusters",L)});const J=document.getElementById("rotationToggle");J.addEventListener("click",()=>{S=!S,J.classList.toggle("active",S),J.setAttribute("aria-checked",S.toString()),J.textContent=S?"Stop Rotation":"Start Rotation",s("showRotation",S),T()});const Q=document.getElementById("shapeToggle");Q.addEventListener("click",()=>{F=!F,Q.classList.toggle("active",F),Q.setAttribute("aria-checked",F.toString()),Q.textContent=F?"Use Circles":"Use Squares",s("useSquares",F)});const Z=document.getElementById("instantRenderToggle");Z.addEventListener("click",()=>{y=!y,Z.classList.toggle("active",y),Z.setAttribute("aria-checked",y.toString()),Z.textContent=y?"Disable Instant Render":"Enable Instant Render",s("instantRender",y)});function ge(){te||(te=setInterval(()=>{(isNaN(c)||!isFinite(c))&&(c=2),(isNaN(I)||!isFinite(I)||I<=0)&&(I=.1),(isNaN(a)||!isFinite(a)||a<=0)&&(a=1),(isNaN(r)||!isFinite(r)||r<=a)&&(r=500);const e=c+I*Se;isNaN(e)||!isFinite(e)?(console.warn("Invalid spiral coefficient calculated, resetting to safe value"),c=me(2,a,r)):c=e,(c<=a||c>=r)&&(Se*=-1,c=me(c,a,r)),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,s("spiralCoeff",c),T()},R))}function be(){te&&(clearInterval(te),te=null)}const ee=document.getElementById("spiralAnimationToggle");ee.addEventListener("click",()=>{h=!h,ee.classList.toggle("active",h),ee.setAttribute("aria-checked",h.toString()),ee.textContent=h?"Stop Spiral Animation":"Animate Spiral Coefficient";const e=document.getElementById("spiralAnimationControls");e.style.display=h?"block":"none",h?ge():be(),s("animateSpiralCoeff",h)});const Me=document.getElementById("spiralAnimationSpeedSlider"),_e=document.getElementById("spiralAnimationSpeedNumber");Me.addEventListener("input",e=>{R=parseInt(e.target.value),_e.value=R,s("spiralAnimationSpeed",R),h&&(be(),ge())});_e.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=50&&t<=500&&!isNaN(t)&&(R=t,t>=100&&t<=500&&(Me.value=R),s("spiralAnimationSpeed",R),h&&(be(),ge()))});const ke=document.getElementById("spiralAnimationIncrementSlider"),Re=document.getElementById("spiralAnimationIncrementNumber");ke.addEventListener("input",e=>{I=parseFloat(e.target.value),Re.value=I,s("spiralAnimationIncrement",I)});Re.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.01&&t<=10&&!isNaN(t)&&(I=t,t>=.01&&t<=2&&(ke.value=I),s("spiralAnimationIncrement",I))});const ze=document.getElementById("spiralAnimationMinSlider"),Pe=document.getElementById("spiralAnimationMinNumber");ze.addEventListener("input",e=>{a=parseFloat(e.target.value),Pe.value=a,s("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,s("spiralAnimationMax",r))});Pe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=1e3&&!isNaN(t)&&(a=t,t>=.1&&t<=100&&(ze.value=a),s("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,s("spiralAnimationMax",r)))});const We=document.getElementById("spiralAnimationMaxSlider"),qe=document.getElementById("spiralAnimationMaxNumber");We.addEventListener("input",e=>{r=parseFloat(e.target.value),qe.value=r,s("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,s("spiralAnimationMin",a))});qe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=10&&t<=2e3&&!isNaN(t)&&(r=t,t>=10&&t<=1e3&&(We.value=r),s("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,s("spiralAnimationMin",a)))});function me(e,t,i){return Math.max(t,Math.min(i,e))}function mt(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber"),i=parseFloat(e.value),n=parseFloat(t.value);!isNaN(i)&&isFinite(i)&&i>0?a=i:(a=1,e.value=a),!isNaN(n)&&isFinite(n)&&n>a?r=n:(r=Math.max(500,a+10),t.value=r),(isNaN(c)||!isFinite(c))&&(c=2),c=me(c,a,r),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,s("spiralCoeff",c),s("spiralAnimationMin",a),s("spiralAnimationMax",r)}function ft(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber");e.value=a=parseFloat(Te("spiralAnimationMin",1)),t.value=r=parseFloat(Te("spiralAnimationMax",500)),mt()}function Te(e,t){if(!N)return t;const n=N.transaction([P],"readonly").objectStore(P);return new Promise(o=>{const l=n.get(e);l.onsuccess=()=>{var u;return o(((u=l.result)==null?void 0:u.value)||t)},l.onerror=()=>o(t)})}window.addEventListener("load",()=>{ft()});function pe(e,t){let i;return function(...o){const l=()=>{clearTimeout(i),e(...o)};clearTimeout(i),i=setTimeout(l,t)}}const ie=pe(T,100),De=pe(Ee,100),Ue=document.getElementById("spiralSlider"),Ke=document.getElementById("spiralNumber");Ue.addEventListener("input",e=>{c=parseFloat(e.target.value),Ke.value=c,s("spiralCoeff",c),y?T():ie()});Ke.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(c=t,t>=2&&t<=200&&(Ue.value=c),s("spiralCoeff",c),y?T():ie())});const He=document.getElementById("maxNSlider"),je=document.getElementById("maxNNumber");He.addEventListener("input",e=>{M=parseInt(e.target.value),je.value=M,s("maxN",M),y?T():ie()});je.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(M=t,t>=2e4&&t<=19e4&&(He.value=M),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),s("maxN",M),y?T():ie())});const Ye=document.getElementById("clusterCountSlider"),Oe=document.getElementById("clusterCountNumber");Ye.addEventListener("input",e=>{z=parseInt(e.target.value),Oe.value=z,s("clusterCount",z),De()});Oe.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(z=t,t>=100&&t<=200&&(Ye.value=z),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),s("clusterCount",z),De())});const Ve=document.getElementById("rotationSpeedSlider"),Xe=document.getElementById("rotationSpeedNumber");Ve.addEventListener("input",e=>{W=parseFloat(e.target.value),Xe.value=W,s("rotationSpeed",W)});Xe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(W=t,t>=.1&&t<=5&&(Ve.value=W),s("rotationSpeed",W))});const $e=document.getElementById("dotSizeSlider"),Ge=document.getElementById("dotSizeNumber");$e.addEventListener("input",e=>{q=parseFloat(e.target.value),Ge.value=q,s("dotSize",q)});Ge.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(q=t,t>=.5&&t<=10&&($e.value=q),s("dotSize",q))});const Je=document.getElementById("primeSizeSlider"),Qe=document.getElementById("primeSizeNumber");Je.addEventListener("input",e=>{D=parseFloat(e.target.value),Qe.value=D,s("primeSize",D)});Qe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(D=t,t>=.5&&t<=5&&(Je.value=D),s("primeSize",D))});document.addEventListener("keydown",e=>{O(),!(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")&&(e.key==="Escape"&&(d?window.__TAURI__?x?(console.log("ESC: Toggling interface visibility in fullscreen (was fullscreen before)"),p?(re(),p=!1):(ae(),p=!0)):(console.log("ESC: Exiting fullscreen"),d=!1,x=!1,ye=!0,p=!1,ue(),Y(),s("isFullscreen",d),setTimeout(()=>{j()},500)):x?p?(re(),p=!1):(ae(),p=!0):(d=!1,ue(),Y(),x=!1,p=!1,setTimeout(()=>{j()},500)):Fe.classList.contains("collapsed")||ne.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),d&&x?(console.log("F key: Toggling interface visibility in fullscreen (was fullscreen before)"),p?(re(),p=!1):(ae(),p=!0)):Be()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),ne.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),$.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),G.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),J.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),Q.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),Z.click()),e.key==="m"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),ee.click()))});document.addEventListener("mousemove",O);document.addEventListener("click",O);document.addEventListener("mousedown",O);window.addEventListener("resize",Ce);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),he()},500)});if(window.__TAURI__){const e=pe(j,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{j()}),window.debugSaveWindowState=j,window.debugLoadWindowState=he,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}let K=!0;function gt(e,t){if(!t)return;const i=document.createElement("div");i.className="tooltip bottom",i.textContent=t,e.appendChild(i);const n=document.createElement("div");n.className="tooltip-icon",n.textContent="i",e.appendChild(n);function o(){if(!K)return;const f=e.getBoundingClientRect(),v=i.getBoundingClientRect(),b=window.innerHeight;i.className="tooltip",f.top>v.height+10?i.classList.add("top"):f.bottom+v.height+10<b?i.classList.add("bottom"):f.left>v.width+10?i.classList.add("left"):i.classList.add("right")}let l;n.addEventListener("click",f=>{f.stopPropagation(),f.preventDefault(),K&&(console.log("Tooltip icon clicked for:",t),o(),i.classList.add("show"),l&&clearTimeout(l),l=setTimeout(()=>{i.classList.remove("show")},3e3))}),e.classList.contains("toggle-button")&&e.addEventListener("click",f=>{f.stopPropagation()}),document.addEventListener("click",f=>{e.contains(f.target)||(i.classList.remove("show"),l&&clearTimeout(l))});let u;e.addEventListener("mouseenter",()=>{K&&(u=setTimeout(()=>{o(),i.classList.add("show")},500))}),e.addEventListener("mouseleave",()=>{u&&clearTimeout(u),i.classList.remove("show")})}function pt(){document.querySelectorAll("[data-tooltip]").forEach(t=>{const i=t.getAttribute("data-tooltip");gt(t,i)})}function Ne(){const e=document.body;K?e.classList.remove("tooltips-disabled"):(e.classList.add("tooltips-disabled"),document.querySelectorAll(".tooltip.show").forEach(t=>{t.classList.remove("show")}))}function wt(){const e=document.getElementById("disableTooltips");if(e){if(N){const i=N.transaction([P],"readonly").objectStore(P);i.get("tooltipsEnabled").onsuccess=n=>{n.target.result!==void 0&&(K=n.target.result.value,e.checked=!K,Ne())}}e.addEventListener("change",t=>{K=!t.target.checked,Ne(),s("tooltipsEnabled",K)})}}lt();Ce();requestAnimationFrame(Le);setTimeout(()=>{pt(),wt()},100);
