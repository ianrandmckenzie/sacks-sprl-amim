(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const C of r.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&s(C)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const c=document.getElementById("spiralCanvas"),o=c.getContext("2d");let M=3,p=2e4,y=100,h=[],m=!0,g=!1,u=!1,b=1,Q=0,f=!1,I=2,x=2,z=!1,a=!1,v=100;const U=200,Ee=1,Se=10,be=.25,W=[];let X=null;function ee(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),X&&clearTimeout(X),X=setTimeout(()=>{e.classList.remove("show")},3e3)}function Ie(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function te(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function ne(){z?te():Ie()}function _(){const e=z;z=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const t=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");z?(t.style.display="none",n.style.display="none",s.style.display="none",e||ee()):(t.style.display="flex",n.style.display="flex",s.style.display="flex",s.textContent="⛶",s.title="Toggle Fullscreen",document.getElementById("fullscreenToast").classList.remove("show"))}let T;const xe="SpiralPrefs",Ce=1,O="preferences";function we(){const e=indexedDB.open(xe,Ce);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{T=t.target.result,Be()},e.onupgradeneeded=t=>{T=t.target.result,T.createObjectStore(O,{keyPath:"id"})}}function l(e,t){if(!T)return;T.transaction([O],"readwrite").objectStore(O).put({id:e,value:t})}function Be(){if(!T)return;const t=T.transaction([O],"readonly").objectStore(O);t.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const s=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle");n.target.result.value?(s.classList.add("collapsed"),i.textContent="☰",i.setAttribute("aria-expanded","false")):(i.textContent="✕",i.setAttribute("aria-expanded","true"))}else{const s=document.getElementById("sidebarToggle");s.textContent="✕",s.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=n=>{n.target.result&&(y=n.target.result.value,document.getElementById("spiralSlider").value=y,document.getElementById("spiralNumber").value=y,E())},t.get("maxN").onsuccess=n=>{n.target.result&&(p=n.target.result.value,document.getElementById("maxNSlider").value=p,document.getElementById("maxNNumber").value=p,E())},t.get("clusterCount").onsuccess=n=>{n.target.result&&(v=n.target.result.value,document.getElementById("clusterCountSlider").value=v,document.getElementById("clusterCountNumber").value=v,V())},t.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){m=n.target.result.value;const s=document.getElementById("primeToggle");s.classList.toggle("active",m),s.setAttribute("aria-checked",m.toString()),s.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers"}},t.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){g=n.target.result.value;const s=document.getElementById("clusterToggle");s.classList.toggle("active",g),s.setAttribute("aria-checked",g.toString()),s.textContent=g?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){u=n.target.result.value;const s=document.getElementById("rotationToggle");s.classList.toggle("active",u),s.setAttribute("aria-checked",u.toString()),s.textContent=u?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=n=>{n.target.result&&(b=n.target.result.value,document.getElementById("rotationSpeedSlider").value=b,document.getElementById("rotationSpeedNumber").value=b)},t.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){f=n.target.result.value;const s=document.getElementById("shapeToggle");s.classList.toggle("active",f),s.setAttribute("aria-checked",f.toString()),s.textContent=f?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=n=>{if(n.target.result!==void 0){a=n.target.result.value;const s=document.getElementById("instantRenderToggle");s.classList.toggle("active",a),s.setAttribute("aria-checked",a.toString()),s.textContent=a?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=n=>{n.target.result&&(I=n.target.result.value,document.getElementById("dotSizeSlider").value=I,document.getElementById("dotSizeNumber").value=I)},t.get("primeSize").onsuccess=n=>{n.target.result&&(x=n.target.result.value,document.getElementById("primeSizeSlider").value=x,document.getElementById("primeSizeNumber").value=x)},t.get("scale").onsuccess=n=>{n.target.result&&(M=n.target.result.value,E())}}const k=new Map;function Z(e){if(k.has(e))return k.get(e);if(e<2)return k.set(e,!1),!1;if(e===2)return k.set(e,!0),!0;if(e%2===0)return k.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return k.set(e,!1),!1;return k.set(e,!0),!0}function se(){c.width=innerWidth,c.height=innerHeight,E(),V()}function E(){const e=c.width,t=c.height,n=e/2,s=t/2;h=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const i=Math.min(p,2e6),C=Math.sqrt(e*e+t*t)/2;if(a){for(let w=1;w<=i;w++){const S=Math.sqrt(w)*M,B=y*Math.PI*Math.sqrt(w),N=n+S*Math.cos(B),d=s+S*Math.sin(B),L=u?C:0;N<-L||N>e+L||d<-L||d>t+L||h.push({x:N,y:d,n:w,isPrime:Z(w)})}p>i&&console.warn(`Capped point calculation at ${i} for performance`)}else{let B=function(){const N=Math.min(S+1e3,i);for(let d=S;d<=N;d++){const L=Math.sqrt(d)*M,H=y*Math.PI*Math.sqrt(d),F=n+L*Math.cos(H),$=s+L*Math.sin(H),j=u?C:0;F<-j||F>e+j||$<-j||$>t+j||h.push({x:F,y:$,n:d,isPrime:Z(d)})}S=N+1,S<=i?window.currentComputationId=requestIdleCallback(B,{timeout:50}):(window.currentComputationId=null,p>i&&console.warn(`Capped point calculation at ${i} for performance`))};var J=B;let S=1;window.currentComputationId=requestIdleCallback(B,{timeout:50})}}function V(){W.length=0;const e=c.width,t=c.height,n=Math.min(v,1e3);for(let s=0;s<n;s++){const i=Math.random()*e,r=Math.random()*t;W.push({x:i,y:r,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}v>n&&console.warn(`Capped cluster count at ${n} for performance`)}function Ne(){const e=c.width,t=c.height;W.forEach(n=>{const s=n.targetX-n.x,i=n.targetY-n.y,r=Math.hypot(s,i);r<n.speed?(n.targetX=Math.random()*e,n.targetY=Math.random()*t):(n.x+=s/r*n.speed,n.y+=i/r*n.speed)})}function ie(){g&&Ne(),u&&(Q+=b*.01),o.fillStyle=`rgba(0,0,0,${be})`,o.fillRect(0,0,c.width,c.height),o.save(),u&&(o.translate(c.width/2,c.height/2),o.rotate(Q),o.translate(-c.width/2,-c.height/2));let e;a||h.length<=1e4?e=h.length:h.length<=5e4?e=Math.min(h.length,2e3):e=Math.min(h.length,5e3);const t=[],n=[];for(let s=0;s<e;s++){const i=h[s%h.length];let r=0;if(g)for(const B of W){const N=i.x-B.x,d=i.y-B.y;if(Math.abs(N)<U&&Math.abs(d)<U){const L=1-Math.abs(N)/U,H=1-Math.abs(d)/U,F=Math.min(L,H);r=Math.max(r,F)}}let C=I;m&&i.isPrime&&(C*=x);const J=C+r*Ee,w=-r*Se,S={...i,size:J,offsetY:w};m&&i.isPrime?t.push(S):n.push(S)}n.length>0&&(o.fillStyle="#009900",n.forEach(s=>{f?o.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(o.beginPath(),o.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),o.fill())})),t.length>0&&(o.fillStyle="#00ff00",t.forEach(s=>{f?o.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(o.beginPath(),o.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),o.fill())})),o.restore(),requestAnimationFrame(ie)}function Le(e,t,n){return Math.max(t,Math.min(n,e))}const ke=G(e=>l("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),M=Le(M*(e.deltaY>0?1.05:.95),2,200),ke(M),a?E():Y()},{passive:!1});const Te=document.getElementById("sidebar");Te.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const Me=document.getElementById("fullscreenToggle");Me.addEventListener("click",ne);document.addEventListener("fullscreenchange",_);document.addEventListener("webkitfullscreenchange",_);document.addEventListener("msfullscreenchange",_);c.addEventListener("click",()=>{z&&ee()});const re=document.getElementById("sidebar"),K=document.getElementById("sidebarToggle");K.addEventListener("click",()=>{const e=re.classList.toggle("collapsed");K.textContent=e?"☰":"✕",K.setAttribute("aria-expanded",(!e).toString()),l("sidebarCollapsed",e)});const P=document.getElementById("primeToggle");P.addEventListener("click",()=>{m=!m,P.classList.toggle("active",m),P.setAttribute("aria-checked",m.toString()),P.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers",l("showPrimes",m)});const R=document.getElementById("clusterToggle");R.addEventListener("click",()=>{g=!g,R.classList.toggle("active",g),R.setAttribute("aria-checked",g.toString()),R.textContent=g?"Stop Animation":"Start Animation",l("showClusters",g)});const A=document.getElementById("rotationToggle");A.addEventListener("click",()=>{u=!u,A.classList.toggle("active",u),A.setAttribute("aria-checked",u.toString()),A.textContent=u?"Stop Rotation":"Start Rotation",l("showRotation",u),E()});const q=document.getElementById("shapeToggle");q.addEventListener("click",()=>{f=!f,q.classList.toggle("active",f),q.setAttribute("aria-checked",f.toString()),q.textContent=f?"Use Circles":"Use Squares",l("useSquares",f)});const D=document.getElementById("instantRenderToggle");D.addEventListener("click",()=>{a=!a,D.classList.toggle("active",a),D.setAttribute("aria-checked",a.toString()),D.textContent=a?"Disable Instant Render":"Enable Instant Render",l("instantRender",a)});function G(e,t){let n;return function(...i){const r=()=>{clearTimeout(n),e(...i)};clearTimeout(n),n=setTimeout(r,t)}}const Y=G(E,100),le=G(V,100),oe=document.getElementById("spiralSlider"),ae=document.getElementById("spiralNumber");oe.addEventListener("input",e=>{y=parseFloat(e.target.value),ae.value=y,l("spiralCoeff",y),a?E():Y()});ae.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(y=t,t>=2&&t<=200&&(oe.value=y),l("spiralCoeff",y),a?E():Y())});const ce=document.getElementById("maxNSlider"),ue=document.getElementById("maxNNumber");ce.addEventListener("input",e=>{p=parseInt(e.target.value),ue.value=p,l("maxN",p),a?E():Y()});ue.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(p=t,t>=2e4&&t<=19e4&&(ce.value=p),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),l("maxN",p),a?E():Y())});const de=document.getElementById("clusterCountSlider"),me=document.getElementById("clusterCountNumber");de.addEventListener("input",e=>{v=parseInt(e.target.value),me.value=v,l("clusterCount",v),le()});me.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(v=t,t>=100&&t<=200&&(de.value=v),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),l("clusterCount",v),le())});const ge=document.getElementById("rotationSpeedSlider"),fe=document.getElementById("rotationSpeedNumber");ge.addEventListener("input",e=>{b=parseFloat(e.target.value),fe.value=b,l("rotationSpeed",b)});fe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(b=t,t>=.1&&t<=5&&(ge.value=b),l("rotationSpeed",b))});const pe=document.getElementById("dotSizeSlider"),he=document.getElementById("dotSizeNumber");pe.addEventListener("input",e=>{I=parseFloat(e.target.value),he.value=I,l("dotSize",I)});he.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(I=t,t>=.5&&t<=10&&(pe.value=I),l("dotSize",I))});const ye=document.getElementById("primeSizeSlider"),ve=document.getElementById("primeSizeNumber");ye.addEventListener("input",e=>{x=parseFloat(e.target.value),ve.value=x,l("primeSize",x)});ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(x=t,t>=.5&&t<=5&&(ye.value=x),l("primeSize",x))});document.addEventListener("keydown",e=>{e.key==="Escape"&&(z?te():re.classList.contains("collapsed")||K.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),ne()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),K.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),P.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),R.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),A.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),q.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),D.click())});window.addEventListener("resize",se);we();se();requestAnimationFrame(ie);
