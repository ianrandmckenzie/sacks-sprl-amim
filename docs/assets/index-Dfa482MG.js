(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const Ee=document.getElementById("spiralCanvas");Ee.getContext("2d");let I=5e3,c=2,_=!0,L=!0,M=!0,S=.1,R=!0,T=.1,h=10,u=!1,g=!1,j=!0,d=!1,x=!1,m=!1,y=100,v=.1,s=1,a=500,G=1,C=null,E=100,b=null;function Z(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),b&&clearTimeout(b),b=setTimeout(()=>{e.classList.remove("show")},3e3)}async function J(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else{const e=document.documentElement;try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}}async function W(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}}async function z(){console.log("Showing interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle");e.style.display="flex",t.style.display="flex",n.style.display="flex";const i=document.getElementById("fullscreenToast");i.textContent="Interface restored - Use macOS fullscreen controls to exit, or ESC to hide interface",i.classList.add("show"),b&&clearTimeout(b),b=setTimeout(()=>{i.classList.remove("show"),i.textContent="Press ESC to exit fullscreen"},4e3)}function P(){console.log("Hiding interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle");e.style.display="none",t.style.display="none",n.style.display="none";const i=document.getElementById("fullscreenToast");i.textContent="Interface hidden - Press ESC to show interface",i.classList.add("show"),b&&clearTimeout(b),b=setTimeout(()=>{i.classList.remove("show")},3e3)}async function be(){if(window.__TAURI__)u?g?(console.log("Toggling interface visibility instead of exiting fullscreen (was fullscreen before)"),d?(P(),d=!1):(z(),d=!0)):(console.log("Exiting fullscreen (was not fullscreen before)"),u=!1,g=!1,j=!0,d=!1,await W(),U(),o("isFullscreen",u),setTimeout(()=>{B()},500)):(console.log("Entering fullscreen (was fullscreen before:",u,")"),g=u,u=!0,j=!0,d=!1,await J(),U(),o("isFullscreen",u));else if(!u)g=u,await J();else if(g){Z();return}else await W(),g=!1,d=!1,setTimeout(()=>{B()},500)}function U(){const e=u;window.__TAURI__||(u=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");if(u){if(t.style.display="none",n.style.display="none",i.style.display="none",!e){const l=document.getElementById("fullscreenToast");g?l.textContent="Fullscreen mode - Press ESC to toggle menu":l.textContent="Fullscreen mode - Press ESC to exit fullscreen",Z()}}else{t.style.display="flex",n.style.display="flex",i.style.display="flex",i.textContent="⛶",i.title="Toggle Fullscreen";const l=document.getElementById("fullscreenToast");l.classList.remove("show"),l.textContent="Press ESC to exit fullscreen"}}let w;const Ae="SpiralPrefs",xe=1,A="preferences";function Be(){const e=indexedDB.open(Ae,xe);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{w=t.target.result,Te(),window.__TAURI__&&setTimeout(()=>{O()},200)},e.onupgradeneeded=t=>{w=t.target.result,w.createObjectStore(A,{keyPath:"id"})}}function o(e,t){if(!w)return;w.transaction([A],"readwrite").objectStore(A).put({id:e,value:t})}async function B(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),n=await e.innerPosition(),i=await e.isMaximized();u?console.log("Skipping window size save (in fullscreen mode)"):(o("windowWidth",t.width),o("windowHeight",t.height),o("windowX",n.x),o("windowY",n.y),o("windowMaximized",i),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:u})),o("isFullscreen",u)}catch(e){console.error("Failed to save window state:",e)}}async function O(){if(!window.__TAURI__||!w){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(p=>setTimeout(p,100));const n=w.transaction([A],"readonly").objectStore(A),i=p=>new Promise(K=>{const F=n.get(p);F.onsuccess=()=>{var $;return K(($=F.result)==null?void 0:$.value)},F.onerror=()=>K(null)}),[l,r,f,N,V,Y]=await Promise.all([i("windowWidth"),i("windowHeight"),i("windowX"),i("windowY"),i("windowMaximized"),i("isFullscreen")]);if(console.log("Loaded window state:",{width:l,height:r,x:f,y:N,maximized:V,fullscreen:Y}),l&&r&&l>200&&r>200)if(l<=3840&&r<=2160)try{await e.setSize(new window.__TAURI__.window.LogicalSize(l,r)),console.log("✅ Window size restored:",l,"x",r)}catch(F){console.error("❌ Failed to restore window size:",F)}else console.log("❌ Saved window size too large, skipping restore:",l,"x",r),o("windowWidth",null),o("windowHeight",null);else console.log("❌ No valid window size to restore");if(f!==null&&N!==null&&f>=-1e3&&N>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(f,N)),console.log("✅ Window position restored:",f,",",N)}catch(p){console.error("❌ Failed to restore window position:",p)}else console.log("❌ No valid window position to restore");if(V)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(p){console.error("❌ Failed to restore maximized state:",p)}Y&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),u=!1,g=!1,d=!1,o("isFullscreen",!1))}catch(p){console.error("❌ Failed to restore fullscreen state:",p),u=!1,g=!1,d=!1,o("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function Te(){if(!w)return;const t=w.transaction([A],"readonly").objectStore(A);t.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const i=document.getElementById("sidebar"),l=document.getElementById("sidebarToggle");n.target.result.value?(i.classList.add("collapsed"),l.textContent="☰",l.setAttribute("aria-expanded","false")):(l.textContent="✕",l.setAttribute("aria-expanded","true"))}else{const i=document.getElementById("sidebarToggle");i.textContent="✕",i.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=n=>{n.target.result&&(c=n.target.result.value,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,computePoints())},t.get("maxN").onsuccess=n=>{n.target.result&&(I=n.target.result.value,document.getElementById("maxNSlider").value=I,document.getElementById("maxNNumber").value=I,computePoints())},t.get("clusterCount").onsuccess=n=>{n.target.result&&(E=n.target.result.value,document.getElementById("clusterCountSlider").value=E,document.getElementById("clusterCountNumber").value=E,initClusters())},t.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){_=n.target.result.value;const i=document.getElementById("primeToggle");i.classList.toggle("active",_),i.setAttribute("aria-checked",_.toString()),i.textContent=_?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){L=n.target.result.value;const i=document.getElementById("clusterToggle");i.classList.toggle("active",L),i.setAttribute("aria-checked",L.toString()),i.textContent=L?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){M=n.target.result.value;const i=document.getElementById("rotationToggle");i.classList.toggle("active",M),i.setAttribute("aria-checked",M.toString()),i.textContent=M?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=n=>{n.target.result&&(S=n.target.result.value,document.getElementById("rotationSpeedSlider").value=S,document.getElementById("rotationSpeedNumber").value=S)},t.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){R=n.target.result.value;const i=document.getElementById("shapeToggle");i.classList.toggle("active",R),i.setAttribute("aria-checked",R.toString()),i.textContent=R?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=n=>{if(n.target.result!==void 0){x=n.target.result.value;const i=document.getElementById("instantRenderToggle");i.classList.toggle("active",x),i.setAttribute("aria-checked",x.toString()),i.textContent=x?"Disable Instant Render":"Enable Instant Render"}},t.get("animateSpiralCoeff").onsuccess=n=>{if(n.target.result!==void 0){m=n.target.result.value;const i=document.getElementById("spiralAnimationToggle");i.classList.toggle("active",m),i.setAttribute("aria-checked",m.toString()),i.textContent=m?"Stop Spiral Animation":"Animate Spiral Coefficient";const l=document.getElementById("spiralAnimationControls");l.style.display=m?"block":"none",m&&D()}},t.get("spiralAnimationSpeed").onsuccess=n=>{n.target.result&&(y=n.target.result.value,document.getElementById("spiralAnimationSpeedSlider").value=y,document.getElementById("spiralAnimationSpeedNumber").value=y)},t.get("spiralAnimationIncrement").onsuccess=n=>{n.target.result&&(v=n.target.result.value,document.getElementById("spiralAnimationIncrementSlider").value=v,document.getElementById("spiralAnimationIncrementNumber").value=v)},t.get("spiralAnimationMin").onsuccess=n=>{n.target.result&&(s=n.target.result.value,document.getElementById("spiralAnimationMinSlider").value=s,document.getElementById("spiralAnimationMinNumber").value=s)},t.get("spiralAnimationMax").onsuccess=n=>{n.target.result&&(a=n.target.result.value,document.getElementById("spiralAnimationMaxSlider").value=a,document.getElementById("spiralAnimationMaxNumber").value=a)}}function D(){C||(C=setInterval(()=>{c+=v*G,(c<=s||c>=a)&&(G*=-1),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,o("spiralCoeff",c),computePoints()},y))}function H(){C&&(clearInterval(C),C=null)}const k=document.getElementById("spiralAnimationToggle");k.addEventListener("click",()=>{m=!m,k.classList.toggle("active",m),k.setAttribute("aria-checked",m.toString()),k.textContent=m?"Stop Spiral Animation":"Animate Spiral Coefficient";const e=document.getElementById("spiralAnimationControls");e.style.display=m?"block":"none",m?D():H(),o("animateSpiralCoeff",m)});const ee=document.getElementById("spiralAnimationSpeedSlider"),te=document.getElementById("spiralAnimationSpeedNumber");ee.addEventListener("input",e=>{y=parseInt(e.target.value),te.value=y,o("spiralAnimationSpeed",y),m&&(H(),D())});te.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=50&&t<=500&&!isNaN(t)&&(y=t,t>=100&&t<=500&&(ee.value=y),o("spiralAnimationSpeed",y),m&&(H(),D()))});const ne=document.getElementById("spiralAnimationIncrementSlider"),ie=document.getElementById("spiralAnimationIncrementNumber");ne.addEventListener("input",e=>{v=parseFloat(e.target.value),ie.value=v,o("spiralAnimationIncrement",v)});ie.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.01&&t<=10&&!isNaN(t)&&(v=t,t>=.01&&t<=2&&(ne.value=v),o("spiralAnimationIncrement",v))});const oe=document.getElementById("spiralAnimationMinSlider"),le=document.getElementById("spiralAnimationMinNumber");oe.addEventListener("input",e=>{s=parseFloat(e.target.value),le.value=s,o("spiralAnimationMin",s),s>=a&&(a=s+10,document.getElementById("spiralAnimationMaxSlider").value=a,document.getElementById("spiralAnimationMaxNumber").value=a,o("spiralAnimationMax",a))});le.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=1e3&&!isNaN(t)&&(s=t,t>=.1&&t<=100&&(oe.value=s),o("spiralAnimationMin",s),s>=a&&(a=s+10,document.getElementById("spiralAnimationMaxSlider").value=a,document.getElementById("spiralAnimationMaxNumber").value=a,o("spiralAnimationMax",a)))});const se=document.getElementById("spiralAnimationMaxSlider"),ae=document.getElementById("spiralAnimationMaxNumber");se.addEventListener("input",e=>{a=parseFloat(e.target.value),ae.value=a,o("spiralAnimationMax",a),a<=s&&(s=Math.max(.1,a-10),document.getElementById("spiralAnimationMinSlider").value=s,document.getElementById("spiralAnimationMinNumber").value=s,o("spiralAnimationMin",s))});ae.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=10&&t<=2e3&&!isNaN(t)&&(a=t,t>=10&&t<=1e3&&(se.value=a),o("spiralAnimationMax",a),a<=s&&(s=Math.max(.1,a-10),document.getElementById("spiralAnimationMinSlider").value=s,document.getElementById("spiralAnimationMinNumber").value=s,o("spiralAnimationMin",s)))});function he(e,t,n){return Math.max(t,Math.min(n,e))}function Ne(){const e=document.getElementById("spiralAnimationMin"),t=document.getElementById("spiralAnimationMax");s=parseFloat(e.value),a=parseFloat(t.value),c=he(c,s,a),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,o("spiralCoeff",c),o("spiralAnimationMin",s),o("spiralAnimationMax",a)}function Fe(){const e=document.getElementById("spiralAnimationMin"),t=document.getElementById("spiralAnimationMax");e.value=s=parseFloat(Q("spiralAnimationMin",1)),t.value=a=parseFloat(Q("spiralAnimationMax",500)),Ne()}function Q(e,t){if(!w)return t;const i=w.transaction([A],"readonly").objectStore(A);return new Promise(l=>{const r=i.get(e);r.onsuccess=()=>{var f;return l(((f=r.result)==null?void 0:f.value)||t)},r.onerror=()=>l(t)})}window.addEventListener("load",()=>{Fe()});Be();resize();requestAnimationFrame(drawFrame);function X(e,t){let n;return function(...l){const r=()=>{clearTimeout(n),e(...l)};clearTimeout(n),n=setTimeout(r,t)}}const q=X(computePoints,100),re=X(initClusters,100),ue=document.getElementById("spiralSlider"),ce=document.getElementById("spiralNumber");ue.addEventListener("input",e=>{c=parseFloat(e.target.value),ce.value=c,o("spiralCoeff",c),x?computePoints():q()});ce.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(c=t,t>=2&&t<=200&&(ue.value=c),o("spiralCoeff",c),x?computePoints():q())});const de=document.getElementById("maxNSlider"),me=document.getElementById("maxNNumber");de.addEventListener("input",e=>{I=parseInt(e.target.value),me.value=I,o("maxN",I),x?computePoints():q()});me.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(I=t,t>=2e4&&t<=19e4&&(de.value=I),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),o("maxN",I),x?computePoints():q())});const ge=document.getElementById("clusterCountSlider"),fe=document.getElementById("clusterCountNumber");ge.addEventListener("input",e=>{E=parseInt(e.target.value),fe.value=E,o("clusterCount",E),re()});fe.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(E=t,t>=100&&t<=200&&(ge.value=E),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),o("clusterCount",E),re())});const pe=document.getElementById("rotationSpeedSlider"),we=document.getElementById("rotationSpeedNumber");pe.addEventListener("input",e=>{S=parseFloat(e.target.value),we.value=S,o("rotationSpeed",S)});we.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(S=t,t>=.1&&t<=5&&(pe.value=S),o("rotationSpeed",S))});const ye=document.getElementById("dotSizeSlider"),ve=document.getElementById("dotSizeNumber");ye.addEventListener("input",e=>{T=parseFloat(e.target.value),ve.value=T,o("dotSize",T)});ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(T=t,t>=.5&&t<=10&&(ye.value=T),o("dotSize",T))});const Ie=document.getElementById("primeSizeSlider"),Se=document.getElementById("primeSizeNumber");Ie.addEventListener("input",e=>{h=parseFloat(e.target.value),Se.value=h,o("primeSize",h)});Se.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(h=t,t>=.5&&t<=5&&(Ie.value=h),o("primeSize",h))});document.addEventListener("keydown",e=>{e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||(e.key==="Escape"&&(u?window.__TAURI__?g?(console.log("ESC: Toggling interface visibility in fullscreen (was fullscreen before)"),d?(P(),d=!1):(z(),d=!0)):(console.log("ESC: Exiting fullscreen"),u=!1,g=!1,j=!0,d=!1,W(),U(),o("isFullscreen",u),setTimeout(()=>{B()},500)):g?d?(P(),d=!1):(z(),d=!0):(u=!1,W(),U(),g=!1,d=!1,setTimeout(()=>{B()},500)):sidebar.classList.contains("collapsed")||sidebarToggle.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),u&&g?(console.log("F key: Toggling interface visibility in fullscreen (was fullscreen before)"),d?(P(),d=!1):(z(),d=!0)):be()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),sidebarToggle.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),primeToggle.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),clusterToggle.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),rotationToggle.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),shapeToggle.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),instantRenderToggle.click()))});window.addEventListener("resize",resize);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),O()},500)});if(window.__TAURI__){const e=X(B,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{B()}),window.debugSaveWindowState=B,window.debugLoadWindowState=O,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}
