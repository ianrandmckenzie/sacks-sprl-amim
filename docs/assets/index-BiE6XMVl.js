(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const x of r.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&s(x)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const c=document.getElementById("spiralCanvas"),l=c.getContext("2d");let z=3,p=2e4,h=100,k=[],m=!0,g=!1,u=!1,S=1,Q=0,f=!1,b=2,I=2,F=!1,a=!1,y=100;const U=200,Ee=1,Se=10,be=.25,W=[];let X=null;function ee(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),X&&clearTimeout(X),X=setTimeout(()=>{e.classList.remove("show")},3e3)}function Ie(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function te(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function ne(){F?te():Ie()}function _(){const e=F;F=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const t=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");F?(t.style.display="none",n.style.display="none",s.style.display="none",e||ee()):(t.style.display="flex",n.style.display="flex",s.style.display="flex",s.textContent="⛶",s.title="Toggle Fullscreen",document.getElementById("fullscreenToast").classList.remove("show"))}let T;const xe="SpiralPrefs",Ce=1,O="preferences";function we(){const e=indexedDB.open(xe,Ce);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{T=t.target.result,Be()},e.onupgradeneeded=t=>{T=t.target.result,T.createObjectStore(O,{keyPath:"id"})}}function o(e,t){if(!T)return;T.transaction([O],"readwrite").objectStore(O).put({id:e,value:t})}function Be(){if(!T)return;const t=T.transaction([O],"readonly").objectStore(O);t.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const s=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle");n.target.result.value?(s.classList.add("collapsed"),i.textContent="☰",i.setAttribute("aria-expanded","false")):(i.textContent="✕",i.setAttribute("aria-expanded","true"))}else{const s=document.getElementById("sidebarToggle");s.textContent="✕",s.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=n=>{n.target.result&&(h=n.target.result.value,document.getElementById("spiralSlider").value=h,document.getElementById("spiralNumber").value=h,v())},t.get("maxN").onsuccess=n=>{n.target.result&&(p=n.target.result.value,document.getElementById("maxNSlider").value=p,document.getElementById("maxNNumber").value=p,v())},t.get("clusterCount").onsuccess=n=>{n.target.result&&(y=n.target.result.value,document.getElementById("clusterCountSlider").value=y,document.getElementById("clusterCountNumber").value=y,V())},t.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){m=n.target.result.value;const s=document.getElementById("primeToggle");s.classList.toggle("active",m),s.setAttribute("aria-checked",m.toString()),s.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers"}},t.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){g=n.target.result.value;const s=document.getElementById("clusterToggle");s.classList.toggle("active",g),s.setAttribute("aria-checked",g.toString()),s.textContent=g?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){u=n.target.result.value;const s=document.getElementById("rotationToggle");s.classList.toggle("active",u),s.setAttribute("aria-checked",u.toString()),s.textContent=u?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=n=>{n.target.result&&(S=n.target.result.value,document.getElementById("rotationSpeedSlider").value=S,document.getElementById("rotationSpeedNumber").value=S)},t.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){f=n.target.result.value;const s=document.getElementById("shapeToggle");s.classList.toggle("active",f),s.setAttribute("aria-checked",f.toString()),s.textContent=f?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=n=>{if(n.target.result!==void 0){a=n.target.result.value;const s=document.getElementById("instantRenderToggle");s.classList.toggle("active",a),s.setAttribute("aria-checked",a.toString()),s.textContent=a?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=n=>{n.target.result&&(b=n.target.result.value,document.getElementById("dotSizeSlider").value=b,document.getElementById("dotSizeNumber").value=b)},t.get("primeSize").onsuccess=n=>{n.target.result&&(I=n.target.result.value,document.getElementById("primeSizeSlider").value=I,document.getElementById("primeSizeNumber").value=I)},t.get("scale").onsuccess=n=>{n.target.result&&(z=n.target.result.value,v())}}const L=new Map;function Z(e){if(L.has(e))return L.get(e);if(e<2)return L.set(e,!1),!1;if(e===2)return L.set(e,!0),!0;if(e%2===0)return L.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return L.set(e,!1),!1;return L.set(e,!0),!0}function se(){c.width=innerWidth,c.height=innerHeight,v(),V()}function v(){const e=c.width,t=c.height,n=e/2,s=t/2;k=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const i=Math.min(p,2e6),x=Math.sqrt(e*e+t*t)/2;if(a){for(let C=1;C<=i;C++){const E=Math.sqrt(C)*z,w=h*Math.PI*Math.sqrt(C),B=n+E*Math.cos(w),d=s+E*Math.sin(w),N=u?x:0;B<-N||B>e+N||d<-N||d>t+N||k.push({x:B,y:d,n:C,isPrime:Z(C)})}p>i&&console.warn(`Capped point calculation at ${i} for performance`)}else{let w=function(){const B=Math.min(E+1e3,i);for(let d=E;d<=B;d++){const N=Math.sqrt(d)*z,H=h*Math.PI*Math.sqrt(d),M=n+N*Math.cos(H),$=s+N*Math.sin(H),j=u?x:0;M<-j||M>e+j||$<-j||$>t+j||k.push({x:M,y:$,n:d,isPrime:Z(d)})}E=B+1,E<=i?window.currentComputationId=requestIdleCallback(w,{timeout:50}):(window.currentComputationId=null,p>i&&console.warn(`Capped point calculation at ${i} for performance`))};var J=w;let E=1;window.currentComputationId=requestIdleCallback(w,{timeout:50})}}function V(){W.length=0;const e=c.width,t=c.height,n=Math.min(y,1e3);for(let s=0;s<n;s++){const i=Math.random()*e,r=Math.random()*t;W.push({x:i,y:r,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}y>n&&console.warn(`Capped cluster count at ${n} for performance`)}function Ne(){const e=c.width,t=c.height;W.forEach(n=>{const s=n.targetX-n.x,i=n.targetY-n.y,r=Math.hypot(s,i);r<n.speed?(n.targetX=Math.random()*e,n.targetY=Math.random()*t):(n.x+=s/r*n.speed,n.y+=i/r*n.speed)})}function ie(){g&&Ne(),u&&(Q+=S*.01),l.fillStyle=`rgba(0,0,0,${be})`,l.fillRect(0,0,c.width,c.height),l.save(),u&&(l.translate(c.width/2,c.height/2),l.rotate(Q),l.translate(-c.width/2,-c.height/2));let e;e=k.length;const t=[],n=[];for(let s=0;s<e;s++){const i=k[s%k.length];let r=0;if(g)for(const w of W){const B=i.x-w.x,d=i.y-w.y;if(Math.abs(B)<U&&Math.abs(d)<U){const N=1-Math.abs(B)/U,H=1-Math.abs(d)/U,M=Math.min(N,H);r=Math.max(r,M)}}let x=b;m&&i.isPrime&&(x*=I);const J=x+r*Ee,C=-r*Se,E={...i,size:J,offsetY:C};m&&i.isPrime?t.push(E):n.push(E)}n.length>0&&(l.fillStyle="#009900",n.forEach(s=>{f?l.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(l.beginPath(),l.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),l.fill())})),t.length>0&&(l.fillStyle="#00ff00",t.forEach(s=>{f?l.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(l.beginPath(),l.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),l.fill())})),l.restore(),requestAnimationFrame(ie)}function Le(e,t,n){return Math.max(t,Math.min(n,e))}const ke=G(e=>o("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),z=Le(z*(e.deltaY>0?1.05:.95),2,200),ke(z),a?v():Y()},{passive:!1});const Te=document.getElementById("sidebar");Te.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const ze=document.getElementById("fullscreenToggle");ze.addEventListener("click",ne);document.addEventListener("fullscreenchange",_);document.addEventListener("webkitfullscreenchange",_);document.addEventListener("msfullscreenchange",_);c.addEventListener("click",()=>{F&&ee()});const re=document.getElementById("sidebar"),K=document.getElementById("sidebarToggle");K.addEventListener("click",()=>{const e=re.classList.toggle("collapsed");K.textContent=e?"☰":"✕",K.setAttribute("aria-expanded",(!e).toString()),o("sidebarCollapsed",e)});const P=document.getElementById("primeToggle");P.addEventListener("click",()=>{m=!m,P.classList.toggle("active",m),P.setAttribute("aria-checked",m.toString()),P.textContent=m?"Default Prime Numbers":"Highlight Prime Numbers",o("showPrimes",m)});const R=document.getElementById("clusterToggle");R.addEventListener("click",()=>{g=!g,R.classList.toggle("active",g),R.setAttribute("aria-checked",g.toString()),R.textContent=g?"Stop Animation":"Start Animation",o("showClusters",g)});const A=document.getElementById("rotationToggle");A.addEventListener("click",()=>{u=!u,A.classList.toggle("active",u),A.setAttribute("aria-checked",u.toString()),A.textContent=u?"Stop Rotation":"Start Rotation",o("showRotation",u),v()});const q=document.getElementById("shapeToggle");q.addEventListener("click",()=>{f=!f,q.classList.toggle("active",f),q.setAttribute("aria-checked",f.toString()),q.textContent=f?"Use Circles":"Use Squares",o("useSquares",f)});const D=document.getElementById("instantRenderToggle");D.addEventListener("click",()=>{a=!a,D.classList.toggle("active",a),D.setAttribute("aria-checked",a.toString()),D.textContent=a?"Disable Instant Render":"Enable Instant Render",o("instantRender",a)});function G(e,t){let n;return function(...i){const r=()=>{clearTimeout(n),e(...i)};clearTimeout(n),n=setTimeout(r,t)}}const Y=G(v,100),oe=G(V,100),le=document.getElementById("spiralSlider"),ae=document.getElementById("spiralNumber");le.addEventListener("input",e=>{h=parseFloat(e.target.value),ae.value=h,o("spiralCoeff",h),a?v():Y()});ae.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(h=t,t>=2&&t<=200&&(le.value=h),o("spiralCoeff",h),a?v():Y())});const ce=document.getElementById("maxNSlider"),ue=document.getElementById("maxNNumber");ce.addEventListener("input",e=>{p=parseInt(e.target.value),ue.value=p,o("maxN",p),a?v():Y()});ue.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(p=t,t>=2e4&&t<=19e4&&(ce.value=p),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),o("maxN",p),a?v():Y())});const de=document.getElementById("clusterCountSlider"),me=document.getElementById("clusterCountNumber");de.addEventListener("input",e=>{y=parseInt(e.target.value),me.value=y,o("clusterCount",y),oe()});me.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(y=t,t>=100&&t<=200&&(de.value=y),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),o("clusterCount",y),oe())});const ge=document.getElementById("rotationSpeedSlider"),fe=document.getElementById("rotationSpeedNumber");ge.addEventListener("input",e=>{S=parseFloat(e.target.value),fe.value=S,o("rotationSpeed",S)});fe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(S=t,t>=.1&&t<=5&&(ge.value=S),o("rotationSpeed",S))});const pe=document.getElementById("dotSizeSlider"),he=document.getElementById("dotSizeNumber");pe.addEventListener("input",e=>{b=parseFloat(e.target.value),he.value=b,o("dotSize",b)});he.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(b=t,t>=.5&&t<=10&&(pe.value=b),o("dotSize",b))});const ye=document.getElementById("primeSizeSlider"),ve=document.getElementById("primeSizeNumber");ye.addEventListener("input",e=>{I=parseFloat(e.target.value),ve.value=I,o("primeSize",I)});ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(I=t,t>=.5&&t<=5&&(ye.value=I),o("primeSize",I))});document.addEventListener("keydown",e=>{e.key==="Escape"&&(F?te():re.classList.contains("collapsed")||K.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),ne()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),K.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),P.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),R.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),A.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),q.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),D.click())});window.addEventListener("resize",se);we();se();requestAnimationFrame(ie);
