(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const i=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-i))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const I=document.getElementById("spiralCanvas"),h=I.getContext("2d");let G=5,_=5e3,c=2,z=[],M=!0,C=!0,x=!0,U=.1,Le=0,F=!1,K=.1,H=10,u=!1,w=!1,ge=!0,f=!1,E=!0,b=!1,P=100,S=.1,a=1,r=500,Ne=1,ce=null,k=null,pe=!1;const ot=2e3;let q=100;const fe=200,st=1,lt=10,at=.25,we=[];function rt(){u&&!pe&&(document.body.style.cursor="none",pe=!0)}function ve(){pe&&(document.body.style.cursor="auto",pe=!1)}function X(){k&&clearTimeout(k),u&&(ve(),k=setTimeout(rt,ot))}let R=null;function Z(e){return window.matchMedia("(hover: none) and (pointer: coarse)").matches?e.replace(/Press ESC/g,"Tap ✕ at the top-right of this screen").replace(/ESC to/g,"Tap ✕ at the top-right of this screen to").replace(/or ESC/g,"or tap ✕ at the top-right of this screen"):e}function Se(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),R&&clearTimeout(R),R=setTimeout(()=>{e.classList.remove("show")},3e3)}async function Be(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else{const e=document.documentElement;try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}X()}async function ee(){if(k&&(clearTimeout(k),k=null),ve(),window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}}async function J(){console.log("Showing interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="flex",t.style.display="flex",i.style.display="flex",k&&(clearTimeout(k),k=null),ve();const n=document.getElementById("fullscreenToast");n.textContent=Z("Interface restored - Use macOS fullscreen controls to exit, or ESC to hide interface"),n.classList.add("show"),R&&clearTimeout(R),R=setTimeout(()=>{n.classList.remove("show"),n.textContent=Z("Press ESC to exit fullscreen")},4e3)}function Q(){console.log("Hiding interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="none",t.style.display="none",i.style.display="none",X();const n=document.getElementById("fullscreenToast");n.textContent=Z("Interface hidden - Press ESC to show interface"),n.classList.add("show"),R&&clearTimeout(R),R=setTimeout(()=>{n.classList.remove("show")},3e3)}async function _e(){if(window.__TAURI__)u?w?(console.log("Toggling interface visibility instead of exiting fullscreen (was fullscreen before)"),f?(Q(),f=!1):(J(),f=!0)):(console.log("Exiting fullscreen (was not fullscreen before)"),u=!1,w=!1,ge=!0,f=!1,await ee(),Y(),l("isFullscreen",u),setTimeout(()=>{j()},500)):(console.log("Entering fullscreen (was fullscreen before:",u,")"),w=u,u=!0,ge=!0,f=!1,await Be(),Y(),l("isFullscreen",u));else if(!u)w=u,await Be();else if(w){Se();return}else await ee(),w=!1,f=!1,setTimeout(()=>{j()},500)}function Y(){const e=u;window.__TAURI__||(u=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle"),o=document.getElementById("mobileFullscreenExit");if(u){if(t.style.display="none",i.style.display="none",n.style.display="none",o.classList.add("show"),e||X(),!e){const s=document.getElementById("fullscreenToast"),d=window.matchMedia("(hover: none) and (pointer: coarse)").matches;w?s.textContent=d?"Fullscreen mode - Tap ✕ at the top-right of this screen to toggle menu":"Fullscreen mode - Press ESC to toggle menu":s.textContent=d?"Fullscreen mode - Tap ✕ at the top-right of this screen to exit fullscreen":"Fullscreen mode - Press ESC to exit fullscreen",Se()}}else{t.style.display="flex",i.style.display="flex",n.style.display="flex",n.textContent="⛶",n.title="Toggle Fullscreen",o.classList.remove("show"),e&&(k&&(clearTimeout(k),k=null),ve());const s=document.getElementById("fullscreenToast");s.classList.remove("show"),s.textContent=Z("Press ESC to exit fullscreen")}}let L;const ct="SpiralPrefs",dt=1,D="preferences";function ut(){const e=indexedDB.open(ct,dt);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{L=t.target.result,mt(),window.__TAURI__&&setTimeout(()=>{Te()},200)},e.onupgradeneeded=t=>{L=t.target.result,L.createObjectStore(D,{keyPath:"id"})}}function l(e,t){if(!L)return;L.transaction([D],"readwrite").objectStore(D).put({id:e,value:t})}async function j(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),i=await e.innerPosition(),n=await e.isMaximized();u?console.log("Skipping window size save (in fullscreen mode)"):(l("windowWidth",t.width),l("windowHeight",t.height),l("windowX",i.x),l("windowY",i.y),l("windowMaximized",n),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:u})),l("isFullscreen",u)}catch(e){console.error("Failed to save window state:",e)}}async function Te(){if(!window.__TAURI__||!L){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(g=>setTimeout(g,100));const i=L.transaction([D],"readonly").objectStore(D),n=g=>new Promise(T=>{const p=i.get(g);p.onsuccess=()=>{var B;return T((B=p.result)==null?void 0:B.value)},p.onerror=()=>T(null)}),[o,s,d,N,m,y]=await Promise.all([n("windowWidth"),n("windowHeight"),n("windowX"),n("windowY"),n("windowMaximized"),n("isFullscreen")]);if(console.log("Loaded window state:",{width:o,height:s,x:d,y:N,maximized:m,fullscreen:y}),o&&s&&o>200&&s>200)if(o<=3840&&s<=2160)try{await e.setSize(new window.__TAURI__.window.LogicalSize(o,s)),console.log("✅ Window size restored:",o,"x",s)}catch(p){console.error("❌ Failed to restore window size:",p)}else console.log("❌ Saved window size too large, skipping restore:",o,"x",s),l("windowWidth",null),l("windowHeight",null);else console.log("❌ No valid window size to restore");if(d!==null&&N!==null&&d>=-1e3&&N>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(d,N)),console.log("✅ Window position restored:",d,",",N)}catch(g){console.error("❌ Failed to restore window position:",g)}else console.log("❌ No valid window position to restore");if(m)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(g){console.error("❌ Failed to restore maximized state:",g)}y&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),u=!1,w=!1,f=!1,l("isFullscreen",!1))}catch(g){console.error("❌ Failed to restore fullscreen state:",g),u=!1,w=!1,f=!1,l("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function mt(){if(!L)return;const t=L.transaction([D],"readonly").objectStore(D);t.get("sidebarCollapsed").onsuccess=i=>{if(i.target.result){const n=document.getElementById("sidebar"),o=document.getElementById("sidebarToggle");i.target.result.value?(n.classList.add("collapsed"),v(o,"☰"),o.setAttribute("aria-expanded","false")):(v(o,"✕"),o.setAttribute("aria-expanded","true"))}else{const n=document.getElementById("sidebarToggle");v(n,"✕"),n.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(c=n,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,A()):(console.warn("Invalid spiralCoeff value loaded, resetting to default (2)"),c=2,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,l("spiralCoeff",c),A())}},t.get("maxN").onsuccess=i=>{i.target.result&&(_=i.target.result.value,document.getElementById("maxNSlider").value=_,document.getElementById("maxNNumber").value=_,A())},t.get("clusterCount").onsuccess=i=>{i.target.result&&(q=i.target.result.value,document.getElementById("clusterCountSlider").value=q,document.getElementById("clusterCountNumber").value=q,xe())},t.get("showPrimes").onsuccess=i=>{if(i.target.result!==void 0){M=i.target.result.value;const n=document.getElementById("primeToggle");n.classList.toggle("active",M),n.setAttribute("aria-checked",M.toString()),v(n,M?"Defocus Prime Numbers":"Focus Prime Numbers")}},t.get("showClusters").onsuccess=i=>{if(i.target.result!==void 0){C=i.target.result.value;const n=document.getElementById("clusterToggle");n.classList.toggle("active",C),n.setAttribute("aria-checked",C.toString()),v(n,C?"Stop Animation":"Start Animation")}},t.get("showRotation").onsuccess=i=>{if(i.target.result!==void 0){x=i.target.result.value;const n=document.getElementById("rotationToggle");n.classList.toggle("active",x),n.setAttribute("aria-checked",x.toString()),v(n,x?"Stop Rotation":"Start Rotation")}},t.get("rotationSpeed").onsuccess=i=>{i.target.result&&(U=i.target.result.value,document.getElementById("rotationSpeedSlider").value=U,document.getElementById("rotationSpeedNumber").value=U)},t.get("useSquares").onsuccess=i=>{if(i.target.result!==void 0){F=i.target.result.value;const n=document.getElementById("shapeToggle");n.classList.toggle("active",F),n.setAttribute("aria-checked",F.toString()),v(n,F?"Use Circles":"Use Squares")}},t.get("instantRender").onsuccess=i=>{if(i.target.result!==void 0){E=i.target.result.value;const n=document.getElementById("instantRenderToggle");n.classList.toggle("active",E),n.setAttribute("aria-checked",E.toString()),v(n,E?"Disable Instant Render":"Enable Instant Render")}},t.get("dotSize").onsuccess=i=>{i.target.result&&(K=i.target.result.value,document.getElementById("dotSizeSlider").value=K,document.getElementById("dotSizeNumber").value=K)},t.get("primeSize").onsuccess=i=>{i.target.result&&(H=i.target.result.value,document.getElementById("primeSizeSlider").value=H,document.getElementById("primeSizeNumber").value=H)},t.get("scale").onsuccess=i=>{i.target.result&&(G=i.target.result.value,A())},t.get("animateSpiralCoeff").onsuccess=i=>{if(i.target.result!==void 0){b=i.target.result.value;const n=document.getElementById("spiralAnimationToggle");n.classList.toggle("active",b),n.setAttribute("aria-checked",b.toString()),v(n,b?"Stop Spiral Animation":"Animate Spiral Coefficient");const o=document.getElementById("spiralAnimationControls");o.style.display=b?"block":"none",b&&Ee()}},t.get("spiralAnimationSpeed").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseInt(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>=10&&n<=2e3?(P=n,document.getElementById("spiralAnimationSpeedSlider").value=P,document.getElementById("spiralAnimationSpeedNumber").value=P):(console.warn("Invalid spiralAnimationSpeed value, using default (100)"),P=100)}},t.get("spiralAnimationIncrement").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0&&n<=10?(S=n,document.getElementById("spiralAnimationIncrementSlider").value=S,document.getElementById("spiralAnimationIncrementNumber").value=S):(console.warn("Invalid spiralAnimationIncrement value, using default (0.1)"),S=.1)}},t.get("spiralAnimationMin").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(a=n,document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a):(console.warn("Invalid spiralAnimationMin value, using default (1)"),a=1)}},t.get("spiralAnimationMax").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>a?(r=n,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r):(console.warn("Invalid spiralAnimationMax value, using default (500)"),r=500)}}}const V=new Map;function Me(e){if(V.has(e))return V.get(e);if(e<2)return V.set(e,!1),!1;if(e===2)return V.set(e,!0),!0;if(e%2===0)return V.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return V.set(e,!1),!1;return V.set(e,!0),!0}function ke(){I.width=window.innerWidth,I.height=window.innerHeight,A(),xe()}function A(){const e=I.width,t=I.height,i=e/2,n=t/2;z=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const o=Math.min(_,2e6),d=Math.sqrt(e*e+t*t)/2;if(E){for(let m=1;m<=o;m++){const y=Math.sqrt(m)*G,g=c*Math.PI*Math.sqrt(m),T=i+y*Math.cos(g),p=n+y*Math.sin(g),B=x?d:0;T<-B||T>e+B||p<-B||p>t+B||z.push({x:T,y:p,n:m,isPrime:Me(m)})}_>o&&console.warn(`Capped point calculation at ${o} for performance`)}else{let g=function(){const T=Math.min(y+1e3,o);for(let p=y;p<=T;p++){const B=Math.sqrt(p)*G,ue=c*Math.PI*Math.sqrt(p),ne=i+B*Math.cos(ue),Ie=n+B*Math.sin(ue),me=x?d:0;ne<-me||ne>e+me||Ie<-me||Ie>t+me||z.push({x:ne,y:Ie,n:p,isPrime:Me(p)})}y=T+1,y<=o?window.currentComputationId=requestIdleCallback(g,{timeout:50}):(window.currentComputationId=null,_>o&&console.warn(`Capped point calculation at ${o} for performance`))};var N=g;let y=1;window.currentComputationId=requestIdleCallback(g,{timeout:50})}}function xe(){we.length=0;const e=I.width,t=I.height,i=Math.min(q,1e3);for(let n=0;n<i;n++){const o=Math.random()*e,s=Math.random()*t;we.push({x:o,y:s,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}q>i&&console.warn(`Capped cluster count at ${i} for performance`)}function ft(){const e=I.width,t=I.height;we.forEach(i=>{const n=i.targetX-i.x,o=i.targetY-i.y,s=Math.hypot(n,o);s<i.speed?(i.targetX=Math.random()*e,i.targetY=Math.random()*t):(i.x+=n/s*i.speed,i.y+=o/s*i.speed)})}function Re(){C&&ft(),x&&(Le+=U*.01),h.fillStyle=`rgba(0,0,0,${at})`,h.fillRect(0,0,I.width,I.height),h.save(),x&&(h.translate(I.width/2,I.height/2),h.rotate(Le),h.translate(-I.width/2,-I.height/2));let e;E||z.length<=1e4?e=z.length:z.length<=5e4?e=Math.min(z.length,2e3):e=Math.min(z.length,5e3);const t=[],i=[];for(let n=0;n<e;n++){const o=z[n%z.length];let s=0;if(C)for(const g of we){const T=o.x-g.x,p=o.y-g.y;if(Math.abs(T)<fe&&Math.abs(p)<fe){const B=1-Math.abs(T)/fe,ue=1-Math.abs(p)/fe,ne=Math.min(B,ue);s=Math.max(s,ne)}}let d=K;M&&o.isPrime&&(d*=H);const N=d+s*st,m=-s*lt,y={...o,size:N,offsetY:m};M&&o.isPrime?t.push(y):i.push(y)}i.length>0&&(h.fillStyle="#009900",i.forEach(n=>{F?h.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(h.beginPath(),h.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),h.fill())})),t.length>0&&(h.fillStyle="#00ff00",t.forEach(n=>{F?h.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(h.beginPath(),h.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),h.fill())})),h.restore(),requestAnimationFrame(Re)}const gt=be(e=>l("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),G=he(G*(e.deltaY>0?1.05:.95),2,200),gt(G),E?A():de()},{passive:!1});const pt=document.getElementById("sidebar");pt.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const ze=document.getElementById("fullscreenToggle");ze.addEventListener("click",_e);const ye=document.getElementById("mobileFullscreenExit");ye.addEventListener("click",()=>{u&&(window.__TAURI__?w?f?(Q(),f=!1):(J(),f=!0):(u=!1,w=!1,ge=!0,f=!1,ee(),Y(),l("isFullscreen",u),setTimeout(()=>{j()},500)):w?f?(Q(),f=!1):(J(),f=!0):(u=!1,ee(),Y(),w=!1,f=!1,setTimeout(()=>{j()},500)))});ye.addEventListener("touchstart",e=>{e.preventDefault()});ye.addEventListener("touchend",e=>{e.preventDefault(),ye.click()});document.addEventListener("fullscreenchange",Y);document.addEventListener("webkitfullscreenchange",Y);document.addEventListener("msfullscreenchange",Y);I.addEventListener("click",()=>{u&&Se()});const $=document.getElementById("sidebar"),W=document.getElementById("sidebarToggle");W.addEventListener("click",()=>{const e=$.classList.toggle("collapsed"),t=document.getElementById("fullscreenToggle");if(v(W,e?"☰":"✕"),W.setAttribute("aria-expanded",(!e).toString()),l("sidebarCollapsed",e),window.innerWidth>=768)if(e){$.style.display="none",W.style.display="none",t.style.display="none";const i=document.getElementById("fullscreenToast");i.textContent=Z("Sidebar hidden - Press S to reopen"),i.classList.add("show"),R&&clearTimeout(R),R=setTimeout(()=>{i.classList.remove("show"),i.textContent=Z("Press ESC to exit fullscreen")},3e3)}else $.style.display="flex",W.style.display="flex",t.style.display="flex"});const ie=document.getElementById("primeToggle");ie.addEventListener("click",()=>{M=!M,ie.classList.toggle("active",M),ie.setAttribute("aria-checked",M.toString()),v(ie,M?"Defocus Prime Numbers":"Focus Prime Numbers"),l("showPrimes",M)});const oe=document.getElementById("clusterToggle");oe.addEventListener("click",()=>{C=!C,oe.classList.toggle("active",C),oe.setAttribute("aria-checked",C.toString()),v(oe,C?"Stop Animation":"Start Animation"),l("showClusters",C)});const se=document.getElementById("rotationToggle");se.addEventListener("click",()=>{x=!x,se.classList.toggle("active",x),se.setAttribute("aria-checked",x.toString()),v(se,x?"Stop Rotation":"Start Rotation"),l("showRotation",x),A()});const le=document.getElementById("shapeToggle");le.addEventListener("click",()=>{F=!F,le.classList.toggle("active",F),le.setAttribute("aria-checked",F.toString()),v(le,F?"Use Circles":"Use Squares"),l("useSquares",F)});const ae=document.getElementById("instantRenderToggle");ae.addEventListener("click",()=>{E=!E,ae.classList.toggle("active",E),ae.setAttribute("aria-checked",E.toString()),v(ae,E?"Disable Instant Render":"Enable Instant Render"),l("instantRender",E)});function Ee(){ce||(ce=setInterval(()=>{(isNaN(c)||!isFinite(c))&&(c=2),(isNaN(S)||!isFinite(S)||S<=0)&&(S=.1),(isNaN(a)||!isFinite(a)||a<=0)&&(a=1),(isNaN(r)||!isFinite(r)||r<=a)&&(r=500);const e=c+S*Ne;isNaN(e)||!isFinite(e)?(console.warn("Invalid spiral coefficient calculated, resetting to safe value"),c=he(2,a,r)):c=e,(c<=a||c>=r)&&(Ne*=-1,c=he(c,a,r)),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,l("spiralCoeff",c),A()},P))}function Ae(){ce&&(clearInterval(ce),ce=null)}const re=document.getElementById("spiralAnimationToggle");re.addEventListener("click",()=>{b=!b,re.classList.toggle("active",b),re.setAttribute("aria-checked",b.toString()),v(re,b?"Stop Spiral Animation":"Animate Spiral Coefficient");const e=document.getElementById("spiralAnimationControls");e.style.display=b?"block":"none",b?Ee():Ae(),l("animateSpiralCoeff",b)});const Pe=document.getElementById("spiralAnimationSpeedSlider"),qe=document.getElementById("spiralAnimationSpeedNumber");Pe.addEventListener("input",e=>{P=parseInt(e.target.value),qe.value=P,l("spiralAnimationSpeed",P),b&&(Ae(),Ee())});qe.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=50&&t<=500&&!isNaN(t)&&(P=t,t>=100&&t<=500&&(Pe.value=P),l("spiralAnimationSpeed",P),b&&(Ae(),Ee()))});const De=document.getElementById("spiralAnimationIncrementSlider"),We=document.getElementById("spiralAnimationIncrementNumber");De.addEventListener("input",e=>{S=parseFloat(e.target.value),We.value=S,l("spiralAnimationIncrement",S)});We.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.01&&t<=10&&!isNaN(t)&&(S=t,t>=.01&&t<=2&&(De.value=S),l("spiralAnimationIncrement",S))});const Ue=document.getElementById("spiralAnimationMinSlider"),Ke=document.getElementById("spiralAnimationMinNumber");Ue.addEventListener("input",e=>{a=parseFloat(e.target.value),Ke.value=a,l("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,l("spiralAnimationMax",r))});Ke.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=1e3&&!isNaN(t)&&(a=t,t>=.1&&t<=100&&(Ue.value=a),l("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,l("spiralAnimationMax",r)))});const He=document.getElementById("spiralAnimationMaxSlider"),je=document.getElementById("spiralAnimationMaxNumber");He.addEventListener("input",e=>{r=parseFloat(e.target.value),je.value=r,l("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,l("spiralAnimationMin",a))});je.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=10&&t<=2e3&&!isNaN(t)&&(r=t,t>=10&&t<=1e3&&(He.value=r),l("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,l("spiralAnimationMin",a)))});function he(e,t,i){return Math.max(t,Math.min(i,e))}function wt(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber"),i=parseFloat(e.value),n=parseFloat(t.value);!isNaN(i)&&isFinite(i)&&i>0?a=i:(a=1,e.value=a),!isNaN(n)&&isFinite(n)&&n>a?r=n:(r=Math.max(500,a+10),t.value=r),(isNaN(c)||!isFinite(c))&&(c=2),c=he(c,a,r),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,l("spiralCoeff",c),l("spiralAnimationMin",a),l("spiralAnimationMax",r)}function yt(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber");e.value=a=parseFloat(Ce("spiralAnimationMin",1)),t.value=r=parseFloat(Ce("spiralAnimationMax",500)),wt()}function Ce(e,t){if(!L)return t;const n=L.transaction([D],"readonly").objectStore(D);return new Promise(o=>{const s=n.get(e);s.onsuccess=()=>{var d;return o(((d=s.result)==null?void 0:d.value)||t)},s.onerror=()=>o(t)})}window.addEventListener("load",()=>{yt()});function be(e,t){let i;return function(...o){const s=()=>{clearTimeout(i),e(...o)};clearTimeout(i),i=setTimeout(s,t)}}const de=be(A,100),Ye=be(xe,100),Oe=document.getElementById("spiralSlider"),Ve=document.getElementById("spiralNumber");Oe.addEventListener("input",e=>{c=parseFloat(e.target.value),Ve.value=c,l("spiralCoeff",c),E?A():de()});Ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(c=t,t>=2&&t<=200&&(Oe.value=c),l("spiralCoeff",c),E?A():de())});const $e=document.getElementById("maxNSlider"),Xe=document.getElementById("maxNNumber");$e.addEventListener("input",e=>{_=parseInt(e.target.value),Xe.value=_,l("maxN",_),E?A():de()});Xe.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(_=t,t>=2e4&&t<=19e4&&($e.value=_),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),l("maxN",_),E?A():de())});const Ge=document.getElementById("clusterCountSlider"),Je=document.getElementById("clusterCountNumber");Ge.addEventListener("input",e=>{q=parseInt(e.target.value),Je.value=q,l("clusterCount",q),Ye()});Je.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(q=t,t>=100&&t<=200&&(Ge.value=q),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),l("clusterCount",q),Ye())});const Qe=document.getElementById("rotationSpeedSlider"),Ze=document.getElementById("rotationSpeedNumber");Qe.addEventListener("input",e=>{U=parseFloat(e.target.value),Ze.value=U,l("rotationSpeed",U)});Ze.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(U=t,t>=.1&&t<=5&&(Qe.value=U),l("rotationSpeed",U))});const et=document.getElementById("dotSizeSlider"),tt=document.getElementById("dotSizeNumber");et.addEventListener("input",e=>{K=parseFloat(e.target.value),tt.value=K,l("dotSize",K)});tt.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(K=t,t>=.5&&t<=10&&(et.value=K),l("dotSize",K))});const nt=document.getElementById("primeSizeSlider"),it=document.getElementById("primeSizeNumber");nt.addEventListener("input",e=>{H=parseFloat(e.target.value),it.value=H,l("primeSize",H)});it.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(H=t,t>=.5&&t<=5&&(nt.value=H),l("primeSize",H))});document.addEventListener("keydown",e=>{X(),!(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")&&(e.key==="Escape"&&(u?window.__TAURI__?w?(console.log("ESC: Toggling interface visibility in fullscreen (was fullscreen before)"),f?(Q(),f=!1):(J(),f=!0)):(console.log("ESC: Exiting fullscreen"),u=!1,w=!1,ge=!0,f=!1,ee(),Y(),l("isFullscreen",u),setTimeout(()=>{j()},500)):w?f?(Q(),f=!1):(J(),f=!0):(u=!1,ee(),Y(),w=!1,f=!1,setTimeout(()=>{j()},500)):$.classList.contains("collapsed")||W.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),u&&w?(console.log("F key: Toggling interface visibility in fullscreen (was fullscreen before)"),f?(Q(),f=!1):(J(),f=!0)):_e()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),window.innerWidth>=768&&$.style.display==="none"?($.style.display="flex",W.style.display="flex",ze.style.display="flex",$.classList.remove("collapsed"),v(W,"✕"),W.setAttribute("aria-expanded","true"),l("sidebarCollapsed",!1)):W.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),ie.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),oe.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),se.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),le.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),ae.click()),e.key==="m"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),re.click()))});document.addEventListener("mousemove",X);document.addEventListener("click",X);document.addEventListener("mousedown",X);window.addEventListener("resize",ke);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),Te()},500)});if(window.__TAURI__){const e=be(j,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{j()}),window.debugSaveWindowState=j,window.debugLoadWindowState=Te,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}let O=!0;function v(e,t){const i=e.querySelector(".tooltip"),n=e.querySelector(".tooltip-icon"),o=[];i&&o.push(i),n&&o.push(n),o.forEach(s=>s.remove()),e.textContent=t,o.forEach(s=>e.appendChild(s))}function te(){document.querySelectorAll(".tooltip.show").forEach(t=>{t.classList.remove("show")}),document.querySelectorAll(".tooltip-icon").forEach(t=>{t._tapTimeout&&(clearTimeout(t._tapTimeout),t._tapTimeout=null)})}document.addEventListener("click",te);document.addEventListener("touchend",te);function ht(e,t){if(!t)return;const i=document.createElement("div");i.className="tooltip bottom",i.textContent=t,e.appendChild(i);const n=document.createElement("div");n.className="tooltip-icon",n.textContent="i",e.appendChild(n);function o(){if(!O)return;console.log("Positioning tooltip for:",t);const m=e.getBoundingClientRect(),y=i.getBoundingClientRect(),g=window.innerHeight;i.className="tooltip",window.matchMedia("(hover: none) and (pointer: coarse)").matches?i.classList.add("bottom"):m.top>y.height+10?i.classList.add("top"):m.bottom+y.height+10<g?i.classList.add("bottom"):m.left>y.width+10?i.classList.add("left"):i.classList.add("right"),console.log("Tooltip positioned with class:",i.className)}let s;function d(){O&&(console.log("Showing tooltip for:",t),te(),o(),i.classList.add("show"),s&&clearTimeout(s),n._tapTimeout=s,s=setTimeout(()=>{i.classList.remove("show"),n._tapTimeout=null},4e3))}n.addEventListener("touchstart",m=>{m.stopPropagation(),m.preventDefault()}),n.addEventListener("touchend",m=>{m.stopPropagation(),m.preventDefault(),d()}),n.addEventListener("click",m=>{m.stopPropagation(),m.preventDefault(),d()}),e.classList.contains("toggle-button")&&e.addEventListener("click",m=>{m.stopPropagation()});let N;e.addEventListener("mouseenter",()=>{O&&(N=setTimeout(()=>{te(),o(),i.classList.add("show")},500))}),e.addEventListener("mouseleave",()=>{N&&clearTimeout(N),i.classList.remove("show")})}function vt(){const e=document.querySelectorAll("[data-tooltip]");console.log("Initializing tooltips for",e.length,"elements"),e.forEach((i,n)=>{const o=i.getAttribute("data-tooltip");console.log(`Creating tooltip ${n+1}:`,o),ht(i,o)});const t=window.matchMedia("(hover: none) and (pointer: coarse)").matches;console.log("Mobile device detected:",t)}function Fe(){const e=document.body;O?e.classList.remove("tooltips-disabled"):(e.classList.add("tooltips-disabled"),te())}function Et(){const e=document.getElementById("disableTooltips");if(e){if(L){const i=L.transaction([D],"readonly").objectStore(D);i.get("tooltipsEnabled").onsuccess=n=>{n.target.result!==void 0&&(O=n.target.result.value,e.checked=!O,Fe())}}e.addEventListener("change",t=>{O=!t.target.checked,Fe(),l("tooltipsEnabled",O)})}}function bt(){const e=document.getElementById("aboutLink"),t=document.getElementById("aboutModal"),i=document.getElementById("aboutModalClose");if(!e||!t||!i)return;function n(){t.classList.add("show"),t.setAttribute("aria-hidden","false"),i.focus(),document.body.style.overflow="hidden"}function o(){t.classList.remove("show"),t.setAttribute("aria-hidden","true"),document.body.style.overflow="hidden",e.focus()}e.addEventListener("click",d=>{d.preventDefault(),n()}),i.addEventListener("click",o),t.addEventListener("click",d=>{d.target===t&&o()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&t.classList.contains("show")&&(d.stopPropagation(),o())});const s=te;window.closeAllTooltips=function(){s(),t.classList.contains("show")&&o()}}ut();ke();requestAnimationFrame(Re);setTimeout(()=>{vt(),Et(),bt()},100);
