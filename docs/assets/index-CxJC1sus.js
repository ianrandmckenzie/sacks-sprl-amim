(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&n(g)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();typeof requestIdleCallback>"u"&&(window.requestIdleCallback=function(e,t){const i=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-i))}})},1)});typeof cancelIdleCallback>"u"&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const v=document.getElementById("spiralCanvas"),p=v.getContext("2d");let Y=5,F=5e3,c=2,M=[],B=!0,C=!0,I=!0,z=.1,ye=0,T=!0,R=.1,P=10,u=!1,E=!1,me=!0,f=!1,w=!1,y=!1,L=100,h=.1,a=1,r=500,ve=1,J=null,_=100;const ne=200,Ve=1,Xe=10,$e=.25,ae=[];let W=null;function fe(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),W&&clearTimeout(W),W=setTimeout(()=>{e.classList.remove("show")},3e3)}async function he(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!0)}catch(e){console.error("Failed to enter fullscreen:",e)}else{const e=document.documentElement;try{e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}}async function le(){if(window.__TAURI__)try{await window.__TAURI__.window.getCurrentWindow().setFullscreen(!1)}catch(e){console.error("Failed to exit fullscreen:",e)}else try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}}async function se(){console.log("Showing interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="flex",t.style.display="flex",i.style.display="flex";const n=document.getElementById("fullscreenToast");n.textContent="Interface restored - Use macOS fullscreen controls to exit, or ESC to hide interface",n.classList.add("show"),W&&clearTimeout(W),W=setTimeout(()=>{n.classList.remove("show"),n.textContent="Press ESC to exit fullscreen"},4e3)}function oe(){console.log("Hiding interface in fullscreen mode");const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),i=document.getElementById("fullscreenToggle");e.style.display="none",t.style.display="none",i.style.display="none";const n=document.getElementById("fullscreenToast");n.textContent="Interface hidden - Press ESC to show interface",n.classList.add("show"),W&&clearTimeout(W),W=setTimeout(()=>{n.classList.remove("show")},3e3)}async function Se(){if(window.__TAURI__)u?E?(console.log("Toggling interface visibility instead of exiting fullscreen (was fullscreen before)"),f?(oe(),f=!1):(se(),f=!0)):(console.log("Exiting fullscreen (was not fullscreen before)"),u=!1,E=!1,me=!0,f=!1,await le(),H(),o("isFullscreen",u),setTimeout(()=>{K()},500)):(console.log("Entering fullscreen (was fullscreen before:",u,")"),E=u,u=!0,me=!0,f=!1,await he(),H(),o("isFullscreen",u));else if(!u)E=u,await he();else if(E){fe();return}else await le(),E=!1,f=!1,setTimeout(()=>{K()},500)}function H(){const e=u;window.__TAURI__||(u=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement));const t=document.getElementById("sidebar"),i=document.getElementById("sidebarToggle"),n=document.getElementById("fullscreenToggle");if(u){if(t.style.display="none",i.style.display="none",n.style.display="none",!e){const s=document.getElementById("fullscreenToast");E?s.textContent="Fullscreen mode - Press ESC to toggle menu":s.textContent="Fullscreen mode - Press ESC to exit fullscreen",fe()}}else{t.style.display="flex",i.style.display="flex",n.style.display="flex",n.textContent="⛶",n.title="Toggle Fullscreen";const s=document.getElementById("fullscreenToast");s.classList.remove("show"),s.textContent="Press ESC to exit fullscreen"}}let k;const Ge="SpiralPrefs",Je=1,q="preferences";function Qe(){const e=indexedDB.open(Ge,Je);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{k=t.target.result,Ze(),window.__TAURI__&&setTimeout(()=>{ge()},200)},e.onupgradeneeded=t=>{k=t.target.result,k.createObjectStore(q,{keyPath:"id"})}}function o(e,t){if(!k)return;k.transaction([q],"readwrite").objectStore(q).put({id:e,value:t})}async function K(){if(window.__TAURI__)try{const e=window.__TAURI__.window.getCurrentWindow(),t=await e.innerSize(),i=await e.innerPosition(),n=await e.isMaximized();u?console.log("Skipping window size save (in fullscreen mode)"):(o("windowWidth",t.width),o("windowHeight",t.height),o("windowX",i.x),o("windowY",i.y),o("windowMaximized",n),console.log("Window state saved:",{width:t.width,height:t.height,fullscreen:u})),o("isFullscreen",u)}catch(e){console.error("Failed to save window state:",e)}}async function ge(){if(!window.__TAURI__||!k){console.log("Skipping window state load - Tauri not available or DB not ready");return}console.log("Loading window state...");try{const e=window.__TAURI__.window.getCurrentWindow();await new Promise(d=>setTimeout(d,100));const i=k.transaction([q],"readonly").objectStore(q),n=d=>new Promise(b=>{const m=i.get(d);m.onsuccess=()=>{var N;return b((N=m.result)==null?void 0:N.value)},m.onerror=()=>b(null)}),[s,l,g,U,A,S]=await Promise.all([n("windowWidth"),n("windowHeight"),n("windowX"),n("windowY"),n("windowMaximized"),n("isFullscreen")]);if(console.log("Loaded window state:",{width:s,height:l,x:g,y:U,maximized:A,fullscreen:S}),s&&l&&s>200&&l>200)if(s<=3840&&l<=2160)try{await e.setSize(new window.__TAURI__.window.LogicalSize(s,l)),console.log("✅ Window size restored:",s,"x",l)}catch(m){console.error("❌ Failed to restore window size:",m)}else console.log("❌ Saved window size too large, skipping restore:",s,"x",l),o("windowWidth",null),o("windowHeight",null);else console.log("❌ No valid window size to restore");if(g!==null&&U!==null&&g>=-1e3&&U>=-1e3)try{await e.setPosition(new window.__TAURI__.window.LogicalPosition(g,U)),console.log("✅ Window position restored:",g,",",U)}catch(d){console.error("❌ Failed to restore window position:",d)}else console.log("❌ No valid window position to restore");if(A)try{await e.maximize(),console.log("✅ Window maximized state restored")}catch(d){console.error("❌ Failed to restore maximized state:",d)}S&&setTimeout(async()=>{try{console.log("⚠️  Restoring fullscreen state..."),!1||(console.log("⏭️  Skipping fullscreen restoration (disabled for development)"),u=!1,E=!1,f=!1,o("isFullscreen",!1))}catch(d){console.error("❌ Failed to restore fullscreen state:",d),u=!1,E=!1,f=!1,o("isFullscreen",!1)}},300)}catch(e){console.error("❌ Failed to load window state:",e)}}function Ze(){if(!k)return;const t=k.transaction([q],"readonly").objectStore(q);t.get("sidebarCollapsed").onsuccess=i=>{if(i.target.result){const n=document.getElementById("sidebar"),s=document.getElementById("sidebarToggle");i.target.result.value?(n.classList.add("collapsed"),s.textContent="☰",s.setAttribute("aria-expanded","false")):(s.textContent="✕",s.setAttribute("aria-expanded","true"))}else{const n=document.getElementById("sidebarToggle");n.textContent="✕",n.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(c=n,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,x()):(console.warn("Invalid spiralCoeff value loaded, resetting to default (2)"),c=2,document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,o("spiralCoeff",c),x())}},t.get("maxN").onsuccess=i=>{i.target.result&&(F=i.target.result.value,document.getElementById("maxNSlider").value=F,document.getElementById("maxNNumber").value=F,x())},t.get("clusterCount").onsuccess=i=>{i.target.result&&(_=i.target.result.value,document.getElementById("clusterCountSlider").value=_,document.getElementById("clusterCountNumber").value=_,pe())},t.get("showPrimes").onsuccess=i=>{if(i.target.result!==void 0){B=i.target.result.value;const n=document.getElementById("primeToggle");n.classList.toggle("active",B),n.setAttribute("aria-checked",B.toString()),n.textContent=B?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=i=>{if(i.target.result!==void 0){C=i.target.result.value;const n=document.getElementById("clusterToggle");n.classList.toggle("active",C),n.setAttribute("aria-checked",C.toString()),n.textContent=C?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=i=>{if(i.target.result!==void 0){I=i.target.result.value;const n=document.getElementById("rotationToggle");n.classList.toggle("active",I),n.setAttribute("aria-checked",I.toString()),n.textContent=I?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=i=>{i.target.result&&(z=i.target.result.value,document.getElementById("rotationSpeedSlider").value=z,document.getElementById("rotationSpeedNumber").value=z)},t.get("useSquares").onsuccess=i=>{if(i.target.result!==void 0){T=i.target.result.value;const n=document.getElementById("shapeToggle");n.classList.toggle("active",T),n.setAttribute("aria-checked",T.toString()),n.textContent=T?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=i=>{if(i.target.result!==void 0){w=i.target.result.value;const n=document.getElementById("instantRenderToggle");n.classList.toggle("active",w),n.setAttribute("aria-checked",w.toString()),n.textContent=w?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=i=>{i.target.result&&(R=i.target.result.value,document.getElementById("dotSizeSlider").value=R,document.getElementById("dotSizeNumber").value=R)},t.get("primeSize").onsuccess=i=>{i.target.result&&(P=i.target.result.value,document.getElementById("primeSizeSlider").value=P,document.getElementById("primeSizeNumber").value=P)},t.get("scale").onsuccess=i=>{i.target.result&&(Y=i.target.result.value,x())},t.get("animateSpiralCoeff").onsuccess=i=>{if(i.target.result!==void 0){y=i.target.result.value;const n=document.getElementById("spiralAnimationToggle");n.classList.toggle("active",y),n.setAttribute("aria-checked",y.toString()),n.textContent=y?"Stop Spiral Animation":"Animate Spiral Coefficient";const s=document.getElementById("spiralAnimationControls");s.style.display=y?"block":"none",y&&ce()}},t.get("spiralAnimationSpeed").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseInt(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>=10&&n<=2e3?(L=n,document.getElementById("spiralAnimationSpeedSlider").value=L,document.getElementById("spiralAnimationSpeedNumber").value=L):(console.warn("Invalid spiralAnimationSpeed value, using default (100)"),L=100)}},t.get("spiralAnimationIncrement").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0&&n<=10?(h=n,document.getElementById("spiralAnimationIncrementSlider").value=h,document.getElementById("spiralAnimationIncrementNumber").value=h):(console.warn("Invalid spiralAnimationIncrement value, using default (0.1)"),h=.1)}},t.get("spiralAnimationMin").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>0?(a=n,document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a):(console.warn("Invalid spiralAnimationMin value, using default (1)"),a=1)}},t.get("spiralAnimationMax").onsuccess=i=>{if(i.target.result&&i.target.result.value!==void 0){const n=parseFloat(i.target.result.value);!isNaN(n)&&isFinite(n)&&n>a?(r=n,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r):(console.warn("Invalid spiralAnimationMax value, using default (500)"),r=500)}}}const D=new Map;function Ie(e){if(D.has(e))return D.get(e);if(e<2)return D.set(e,!1),!1;if(e===2)return D.set(e,!0),!0;if(e%2===0)return D.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return D.set(e,!1),!1;return D.set(e,!0),!0}function be(){v.width=window.innerWidth,v.height=window.innerHeight,x(),pe()}function x(){const e=v.width,t=v.height,i=e/2,n=t/2;M=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const s=Math.min(F,2e6),g=Math.sqrt(e*e+t*t)/2;if(w){for(let A=1;A<=s;A++){const S=Math.sqrt(A)*Y,d=c*Math.PI*Math.sqrt(A),b=i+S*Math.cos(d),m=n+S*Math.sin(d),N=I?g:0;b<-N||b>e+N||m<-N||m>t+N||M.push({x:b,y:m,n:A,isPrime:Ie(A)})}F>s&&console.warn(`Capped point calculation at ${s} for performance`)}else{let d=function(){const b=Math.min(S+1e3,s);for(let m=S;m<=b;m++){const N=Math.sqrt(m)*Y,ee=c*Math.PI*Math.sqrt(m),j=i+N*Math.cos(ee),de=n+N*Math.sin(ee),te=I?g:0;j<-te||j>e+te||de<-te||de>t+te||M.push({x:j,y:de,n:m,isPrime:Ie(m)})}S=b+1,S<=s?window.currentComputationId=requestIdleCallback(d,{timeout:50}):(window.currentComputationId=null,F>s&&console.warn(`Capped point calculation at ${s} for performance`))};var U=d;let S=1;window.currentComputationId=requestIdleCallback(d,{timeout:50})}}function pe(){ae.length=0;const e=v.width,t=v.height,i=Math.min(_,1e3);for(let n=0;n<i;n++){const s=Math.random()*e,l=Math.random()*t;ae.push({x:s,y:l,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}_>i&&console.warn(`Capped cluster count at ${i} for performance`)}function et(){const e=v.width,t=v.height;ae.forEach(i=>{const n=i.targetX-i.x,s=i.targetY-i.y,l=Math.hypot(n,s);l<i.speed?(i.targetX=Math.random()*e,i.targetY=Math.random()*t):(i.x+=n/l*i.speed,i.y+=s/l*i.speed)})}function xe(){C&&et(),I&&(ye+=z*.01),p.fillStyle=`rgba(0,0,0,${$e})`,p.fillRect(0,0,v.width,v.height),p.save(),I&&(p.translate(v.width/2,v.height/2),p.rotate(ye),p.translate(-v.width/2,-v.height/2));let e;w||M.length<=1e4?e=M.length:M.length<=5e4?e=Math.min(M.length,2e3):e=Math.min(M.length,5e3);const t=[],i=[];for(let n=0;n<e;n++){const s=M[n%M.length];let l=0;if(C)for(const d of ae){const b=s.x-d.x,m=s.y-d.y;if(Math.abs(b)<ne&&Math.abs(m)<ne){const N=1-Math.abs(b)/ne,ee=1-Math.abs(m)/ne,j=Math.min(N,ee);l=Math.max(l,j)}}let g=R;B&&s.isPrime&&(g*=P);const U=g+l*Ve,A=-l*Xe,S={...s,size:U,offsetY:A};B&&s.isPrime?t.push(S):i.push(S)}i.length>0&&(p.fillStyle="#009900",i.forEach(n=>{T?p.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(p.beginPath(),p.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),p.fill())})),t.length>0&&(p.fillStyle="#00ff00",t.forEach(n=>{T?p.fillRect(n.x-n.size/2,n.y+n.offsetY-n.size/2,n.size,n.size):(p.beginPath(),p.arc(n.x,n.y+n.offsetY,n.size/2,0,2*Math.PI),p.fill())})),p.restore(),requestAnimationFrame(xe)}const tt=ue(e=>o("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),Y=re(Y*(e.deltaY>0?1.05:.95),2,200),tt(Y),w?x():Z()},{passive:!1});const nt=document.getElementById("sidebar");nt.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const it=document.getElementById("fullscreenToggle");it.addEventListener("click",Se);document.addEventListener("fullscreenchange",H);document.addEventListener("webkitfullscreenchange",H);document.addEventListener("msfullscreenchange",H);v.addEventListener("click",()=>{u&&fe()});const Ae=document.getElementById("sidebar"),Q=document.getElementById("sidebarToggle");Q.addEventListener("click",()=>{const e=Ae.classList.toggle("collapsed");Q.textContent=e?"☰":"✕",Q.setAttribute("aria-expanded",(!e).toString()),o("sidebarCollapsed",e)});const O=document.getElementById("primeToggle");O.addEventListener("click",()=>{B=!B,O.classList.toggle("active",B),O.setAttribute("aria-checked",B.toString()),O.textContent=B?"Defocus Prime Numbers":"Focus Prime Numbers",o("showPrimes",B)});const V=document.getElementById("clusterToggle");V.addEventListener("click",()=>{C=!C,V.classList.toggle("active",C),V.setAttribute("aria-checked",C.toString()),V.textContent=C?"Stop Animation":"Start Animation",o("showClusters",C)});const X=document.getElementById("rotationToggle");X.addEventListener("click",()=>{I=!I,X.classList.toggle("active",I),X.setAttribute("aria-checked",I.toString()),X.textContent=I?"Stop Rotation":"Start Rotation",o("showRotation",I),x()});const $=document.getElementById("shapeToggle");$.addEventListener("click",()=>{T=!T,$.classList.toggle("active",T),$.setAttribute("aria-checked",T.toString()),$.textContent=T?"Use Circles":"Use Squares",o("useSquares",T)});const G=document.getElementById("instantRenderToggle");G.addEventListener("click",()=>{w=!w,G.classList.toggle("active",w),G.setAttribute("aria-checked",w.toString()),G.textContent=w?"Disable Instant Render":"Enable Instant Render",o("instantRender",w)});function ce(){J||(J=setInterval(()=>{(isNaN(c)||!isFinite(c))&&(c=2),(isNaN(h)||!isFinite(h)||h<=0)&&(h=.1),(isNaN(a)||!isFinite(a)||a<=0)&&(a=1),(isNaN(r)||!isFinite(r)||r<=a)&&(r=500);const e=c+h*ve;isNaN(e)||!isFinite(e)?(console.warn("Invalid spiral coefficient calculated, resetting to safe value"),c=re(2,a,r)):c=e,(c<=a||c>=r)&&(ve*=-1,c=re(c,a,r)),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,o("spiralCoeff",c),x()},L))}function we(){J&&(clearInterval(J),J=null)}const ie=document.getElementById("spiralAnimationToggle");ie.addEventListener("click",()=>{y=!y,ie.classList.toggle("active",y),ie.setAttribute("aria-checked",y.toString()),ie.textContent=y?"Stop Spiral Animation":"Animate Spiral Coefficient";const e=document.getElementById("spiralAnimationControls");e.style.display=y?"block":"none",y?ce():we(),o("animateSpiralCoeff",y)});const Ne=document.getElementById("spiralAnimationSpeedSlider"),Be=document.getElementById("spiralAnimationSpeedNumber");Ne.addEventListener("input",e=>{L=parseInt(e.target.value),Be.value=L,o("spiralAnimationSpeed",L),y&&(we(),ce())});Be.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=50&&t<=500&&!isNaN(t)&&(L=t,t>=100&&t<=500&&(Ne.value=L),o("spiralAnimationSpeed",L),y&&(we(),ce()))});const Ce=document.getElementById("spiralAnimationIncrementSlider"),Te=document.getElementById("spiralAnimationIncrementNumber");Ce.addEventListener("input",e=>{h=parseFloat(e.target.value),Te.value=h,o("spiralAnimationIncrement",h)});Te.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.01&&t<=10&&!isNaN(t)&&(h=t,t>=.01&&t<=2&&(Ce.value=h),o("spiralAnimationIncrement",h))});const Fe=document.getElementById("spiralAnimationMinSlider"),Me=document.getElementById("spiralAnimationMinNumber");Fe.addEventListener("input",e=>{a=parseFloat(e.target.value),Me.value=a,o("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,o("spiralAnimationMax",r))});Me.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=1e3&&!isNaN(t)&&(a=t,t>=.1&&t<=100&&(Fe.value=a),o("spiralAnimationMin",a),a>=r&&(r=a+10,document.getElementById("spiralAnimationMaxSlider").value=r,document.getElementById("spiralAnimationMaxNumber").value=r,o("spiralAnimationMax",r)))});const Le=document.getElementById("spiralAnimationMaxSlider"),_e=document.getElementById("spiralAnimationMaxNumber");Le.addEventListener("input",e=>{r=parseFloat(e.target.value),_e.value=r,o("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,o("spiralAnimationMin",a))});_e.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=10&&t<=2e3&&!isNaN(t)&&(r=t,t>=10&&t<=1e3&&(Le.value=r),o("spiralAnimationMax",r),r<=a&&(a=Math.max(.1,r-10),document.getElementById("spiralAnimationMinSlider").value=a,document.getElementById("spiralAnimationMinNumber").value=a,o("spiralAnimationMin",a)))});function re(e,t,i){return Math.max(t,Math.min(i,e))}function st(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber"),i=parseFloat(e.value),n=parseFloat(t.value);!isNaN(i)&&isFinite(i)&&i>0?a=i:(a=1,e.value=a),!isNaN(n)&&isFinite(n)&&n>a?r=n:(r=Math.max(500,a+10),t.value=r),(isNaN(c)||!isFinite(c))&&(c=2),c=re(c,a,r),document.getElementById("spiralSlider").value=c,document.getElementById("spiralNumber").value=c,o("spiralCoeff",c),o("spiralAnimationMin",a),o("spiralAnimationMax",r)}function ot(){const e=document.getElementById("spiralAnimationMinNumber"),t=document.getElementById("spiralAnimationMaxNumber");e.value=a=parseFloat(Ee("spiralAnimationMin",1)),t.value=r=parseFloat(Ee("spiralAnimationMax",500)),st()}function Ee(e,t){if(!k)return t;const n=k.transaction([q],"readonly").objectStore(q);return new Promise(s=>{const l=n.get(e);l.onsuccess=()=>{var g;return s(((g=l.result)==null?void 0:g.value)||t)},l.onerror=()=>s(t)})}window.addEventListener("load",()=>{ot()});function ue(e,t){let i;return function(...s){const l=()=>{clearTimeout(i),e(...s)};clearTimeout(i),i=setTimeout(l,t)}}const Z=ue(x,100),ke=ue(pe,100),ze=document.getElementById("spiralSlider"),Re=document.getElementById("spiralNumber");ze.addEventListener("input",e=>{c=parseFloat(e.target.value),Re.value=c,o("spiralCoeff",c),w?x():Z()});Re.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(c=t,t>=2&&t<=200&&(ze.value=c),o("spiralCoeff",c),w?x():Z())});const Pe=document.getElementById("maxNSlider"),We=document.getElementById("maxNNumber");Pe.addEventListener("input",e=>{F=parseInt(e.target.value),We.value=F,o("maxN",F),w?x():Z()});We.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(F=t,t>=2e4&&t<=19e4&&(Pe.value=F),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),o("maxN",F),w?x():Z())});const qe=document.getElementById("clusterCountSlider"),Ue=document.getElementById("clusterCountNumber");qe.addEventListener("input",e=>{_=parseInt(e.target.value),Ue.value=_,o("clusterCount",_),ke()});Ue.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(_=t,t>=100&&t<=200&&(qe.value=_),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),o("clusterCount",_),ke())});const De=document.getElementById("rotationSpeedSlider"),Ke=document.getElementById("rotationSpeedNumber");De.addEventListener("input",e=>{z=parseFloat(e.target.value),Ke.value=z,o("rotationSpeed",z)});Ke.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(z=t,t>=.1&&t<=5&&(De.value=z),o("rotationSpeed",z))});const He=document.getElementById("dotSizeSlider"),Ye=document.getElementById("dotSizeNumber");He.addEventListener("input",e=>{R=parseFloat(e.target.value),Ye.value=R,o("dotSize",R)});Ye.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(R=t,t>=.5&&t<=10&&(He.value=R),o("dotSize",R))});const je=document.getElementById("primeSizeSlider"),Oe=document.getElementById("primeSizeNumber");je.addEventListener("input",e=>{P=parseFloat(e.target.value),Oe.value=P,o("primeSize",P)});Oe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(P=t,t>=.5&&t<=5&&(je.value=P),o("primeSize",P))});document.addEventListener("keydown",e=>{e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||(e.key==="Escape"&&(u?window.__TAURI__?E?(console.log("ESC: Toggling interface visibility in fullscreen (was fullscreen before)"),f?(oe(),f=!1):(se(),f=!0)):(console.log("ESC: Exiting fullscreen"),u=!1,E=!1,me=!0,f=!1,le(),H(),o("isFullscreen",u),setTimeout(()=>{K()},500)):E?f?(oe(),f=!1):(se(),f=!0):(u=!1,le(),H(),E=!1,f=!1,setTimeout(()=>{K()},500)):Ae.classList.contains("collapsed")||Q.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),u&&E?(console.log("F key: Toggling interface visibility in fullscreen (was fullscreen before)"),f?(oe(),f=!1):(se(),f=!0)):Se()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),Q.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),O.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),V.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),X.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),$.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),G.click()))});window.addEventListener("resize",be);window.addEventListener("load",()=>{document.body&&(document.body.tabIndex=-1,document.body.focus()),window.__TAURI__&&setTimeout(()=>{console.log("Attempting window state restore from window load event..."),ge()},500)});if(window.__TAURI__){const e=ue(K,500);window.addEventListener("resize",e),window.addEventListener("focus",e),window.addEventListener("blur",e),window.addEventListener("beforeunload",()=>{K()}),window.debugSaveWindowState=K,window.debugLoadWindowState=ge,console.log("Tauri window state persistence enabled"),console.log("Debug commands available: debugSaveWindowState(), debugLoadWindowState()")}Qe();be();requestAnimationFrame(xe);
