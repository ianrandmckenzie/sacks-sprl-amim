(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const C of i.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&s(C)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const c=document.getElementById("spiralCanvas"),l=c.getContext("2d");let F=5,p=5e3,y=2,h=[],m=!0,g=!0,u=!0,b=.1,Q=0,f=!0,I=.1,x=10,M=!1,a=!1,v=100;const W=200,Ee=1,Se=10,be=.25,$=[];let X=null;function ee(){const e=document.getElementById("fullscreenToast");e.classList.add("show"),X&&clearTimeout(X),X=setTimeout(()=>{e.classList.remove("show")},3e3)}function Ie(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function te(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function ne(){M?te():Ie()}function _(){const e=M;M=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const t=document.getElementById("sidebar"),n=document.getElementById("sidebarToggle"),s=document.getElementById("fullscreenToggle");M?(t.style.display="none",n.style.display="none",s.style.display="none",e||ee()):(t.style.display="flex",n.style.display="flex",s.style.display="flex",s.textContent="⛶",s.title="Toggle Fullscreen",document.getElementById("fullscreenToast").classList.remove("show"))}let T;const xe="SpiralPrefs",Ce=1,O="preferences";function we(){const e=indexedDB.open(xe,Ce);e.onerror=()=>console.warn("IndexedDB not available"),e.onsuccess=t=>{T=t.target.result,Be()},e.onupgradeneeded=t=>{T=t.target.result,T.createObjectStore(O,{keyPath:"id"})}}function o(e,t){if(!T)return;T.transaction([O],"readwrite").objectStore(O).put({id:e,value:t})}function Be(){if(!T)return;const t=T.transaction([O],"readonly").objectStore(O);t.get("sidebarCollapsed").onsuccess=n=>{if(n.target.result){const s=document.getElementById("sidebar"),r=document.getElementById("sidebarToggle");n.target.result.value?(s.classList.add("collapsed"),r.textContent="☰",r.setAttribute("aria-expanded","false")):(r.textContent="✕",r.setAttribute("aria-expanded","true"))}else{const s=document.getElementById("sidebarToggle");s.textContent="✕",s.setAttribute("aria-expanded","true")}},t.get("spiralCoeff").onsuccess=n=>{n.target.result&&(y=n.target.result.value,document.getElementById("spiralSlider").value=y,document.getElementById("spiralNumber").value=y,E())},t.get("maxN").onsuccess=n=>{n.target.result&&(p=n.target.result.value,document.getElementById("maxNSlider").value=p,document.getElementById("maxNNumber").value=p,E())},t.get("clusterCount").onsuccess=n=>{n.target.result&&(v=n.target.result.value,document.getElementById("clusterCountSlider").value=v,document.getElementById("clusterCountNumber").value=v,V())},t.get("showPrimes").onsuccess=n=>{if(n.target.result!==void 0){m=n.target.result.value;const s=document.getElementById("primeToggle");s.classList.toggle("active",m),s.setAttribute("aria-checked",m.toString()),s.textContent=m?"Defocus Prime Numbers":"Focus Prime Numbers"}},t.get("showClusters").onsuccess=n=>{if(n.target.result!==void 0){g=n.target.result.value;const s=document.getElementById("clusterToggle");s.classList.toggle("active",g),s.setAttribute("aria-checked",g.toString()),s.textContent=g?"Stop Animation":"Start Animation"}},t.get("showRotation").onsuccess=n=>{if(n.target.result!==void 0){u=n.target.result.value;const s=document.getElementById("rotationToggle");s.classList.toggle("active",u),s.setAttribute("aria-checked",u.toString()),s.textContent=u?"Stop Rotation":"Start Rotation"}},t.get("rotationSpeed").onsuccess=n=>{n.target.result&&(b=n.target.result.value,document.getElementById("rotationSpeedSlider").value=b,document.getElementById("rotationSpeedNumber").value=b)},t.get("useSquares").onsuccess=n=>{if(n.target.result!==void 0){f=n.target.result.value;const s=document.getElementById("shapeToggle");s.classList.toggle("active",f),s.setAttribute("aria-checked",f.toString()),s.textContent=f?"Use Circles":"Use Squares"}},t.get("instantRender").onsuccess=n=>{if(n.target.result!==void 0){a=n.target.result.value;const s=document.getElementById("instantRenderToggle");s.classList.toggle("active",a),s.setAttribute("aria-checked",a.toString()),s.textContent=a?"Disable Instant Render":"Enable Instant Render"}},t.get("dotSize").onsuccess=n=>{n.target.result&&(I=n.target.result.value,document.getElementById("dotSizeSlider").value=I,document.getElementById("dotSizeNumber").value=I)},t.get("primeSize").onsuccess=n=>{n.target.result&&(x=n.target.result.value,document.getElementById("primeSizeSlider").value=x,document.getElementById("primeSizeNumber").value=x)},t.get("scale").onsuccess=n=>{n.target.result&&(F=n.target.result.value,E())}}const k=new Map;function Z(e){if(k.has(e))return k.get(e);if(e<2)return k.set(e,!1),!1;if(e===2)return k.set(e,!0),!0;if(e%2===0)return k.set(e,!1),!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return k.set(e,!1),!1;return k.set(e,!0),!0}function se(){c.width=innerWidth,c.height=innerHeight,E(),V()}function E(){const e=c.width,t=c.height,n=e/2,s=t/2;h=[],window.currentComputationId&&(cancelIdleCallback(window.currentComputationId),window.currentComputationId=null);const r=Math.min(p,2e6),C=Math.sqrt(e*e+t*t)/2;if(a){for(let w=1;w<=r;w++){const S=Math.sqrt(w)*F,B=y*Math.PI*Math.sqrt(w),N=n+S*Math.cos(B),d=s+S*Math.sin(B),L=u?C:0;N<-L||N>e+L||d<-L||d>t+L||h.push({x:N,y:d,n:w,isPrime:Z(w)})}p>r&&console.warn(`Capped point calculation at ${r} for performance`)}else{let B=function(){const N=Math.min(S+1e3,r);for(let d=S;d<=N;d++){const L=Math.sqrt(d)*F,j=y*Math.PI*Math.sqrt(d),z=n+L*Math.cos(j),H=s+L*Math.sin(j),U=u?C:0;z<-U||z>e+U||H<-U||H>t+U||h.push({x:z,y:H,n:d,isPrime:Z(d)})}S=N+1,S<=r?window.currentComputationId=requestIdleCallback(B,{timeout:50}):(window.currentComputationId=null,p>r&&console.warn(`Capped point calculation at ${r} for performance`))};var J=B;let S=1;window.currentComputationId=requestIdleCallback(B,{timeout:50})}}function V(){$.length=0;const e=c.width,t=c.height,n=Math.min(v,1e3);for(let s=0;s<n;s++){const r=Math.random()*e,i=Math.random()*t;$.push({x:r,y:i,targetX:Math.random()*e,targetY:Math.random()*t,speed:2+Math.random()*1})}v>n&&console.warn(`Capped cluster count at ${n} for performance`)}function Ne(){const e=c.width,t=c.height;$.forEach(n=>{const s=n.targetX-n.x,r=n.targetY-n.y,i=Math.hypot(s,r);i<n.speed?(n.targetX=Math.random()*e,n.targetY=Math.random()*t):(n.x+=s/i*n.speed,n.y+=r/i*n.speed)})}function re(){g&&Ne(),u&&(Q+=b*.01),l.fillStyle=`rgba(0,0,0,${be})`,l.fillRect(0,0,c.width,c.height),l.save(),u&&(l.translate(c.width/2,c.height/2),l.rotate(Q),l.translate(-c.width/2,-c.height/2));let e;a||h.length<=1e4?e=h.length:h.length<=5e4?e=Math.min(h.length,2e3):e=Math.min(h.length,5e3);const t=[],n=[];for(let s=0;s<e;s++){const r=h[s%h.length];let i=0;if(g)for(const B of $){const N=r.x-B.x,d=r.y-B.y;if(Math.abs(N)<W&&Math.abs(d)<W){const L=1-Math.abs(N)/W,j=1-Math.abs(d)/W,z=Math.min(L,j);i=Math.max(i,z)}}let C=I;m&&r.isPrime&&(C*=x);const J=C+i*Ee,w=-i*Se,S={...r,size:J,offsetY:w};m&&r.isPrime?t.push(S):n.push(S)}n.length>0&&(l.fillStyle="#009900",n.forEach(s=>{f?l.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(l.beginPath(),l.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),l.fill())})),t.length>0&&(l.fillStyle="#00ff00",t.forEach(s=>{f?l.fillRect(s.x-s.size/2,s.y+s.offsetY-s.size/2,s.size,s.size):(l.beginPath(),l.arc(s.x,s.y+s.offsetY,s.size/2,0,2*Math.PI),l.fill())})),l.restore(),requestAnimationFrame(re)}function Le(e,t,n){return Math.max(t,Math.min(n,e))}const ke=G(e=>o("scale",e),200);window.addEventListener("wheel",e=>{e.preventDefault(),F=Le(F*(e.deltaY>0?1.05:.95),2,200),ke(F),a?E():Y()},{passive:!1});const Te=document.getElementById("sidebar");Te.addEventListener("wheel",e=>{e.stopPropagation()},{passive:!0});const Fe=document.getElementById("fullscreenToggle");Fe.addEventListener("click",ne);document.addEventListener("fullscreenchange",_);document.addEventListener("webkitfullscreenchange",_);document.addEventListener("msfullscreenchange",_);c.addEventListener("click",()=>{M&&ee()});const ie=document.getElementById("sidebar"),K=document.getElementById("sidebarToggle");K.addEventListener("click",()=>{const e=ie.classList.toggle("collapsed");K.textContent=e?"☰":"✕",K.setAttribute("aria-expanded",(!e).toString()),o("sidebarCollapsed",e)});const P=document.getElementById("primeToggle");P.addEventListener("click",()=>{m=!m,P.classList.toggle("active",m),P.setAttribute("aria-checked",m.toString()),P.textContent=m?"Defocus Prime Numbers":"Focus Prime Numbers",o("showPrimes",m)});const R=document.getElementById("clusterToggle");R.addEventListener("click",()=>{g=!g,R.classList.toggle("active",g),R.setAttribute("aria-checked",g.toString()),R.textContent=g?"Stop Animation":"Start Animation",o("showClusters",g)});const A=document.getElementById("rotationToggle");A.addEventListener("click",()=>{u=!u,A.classList.toggle("active",u),A.setAttribute("aria-checked",u.toString()),A.textContent=u?"Stop Rotation":"Start Rotation",o("showRotation",u),E()});const q=document.getElementById("shapeToggle");q.addEventListener("click",()=>{f=!f,q.classList.toggle("active",f),q.setAttribute("aria-checked",f.toString()),q.textContent=f?"Use Circles":"Use Squares",o("useSquares",f)});const D=document.getElementById("instantRenderToggle");D.addEventListener("click",()=>{a=!a,D.classList.toggle("active",a),D.setAttribute("aria-checked",a.toString()),D.textContent=a?"Disable Instant Render":"Enable Instant Render",o("instantRender",a)});function G(e,t){let n;return function(...r){const i=()=>{clearTimeout(n),e(...r)};clearTimeout(n),n=setTimeout(i,t)}}const Y=G(E,100),oe=G(V,100),le=document.getElementById("spiralSlider"),ae=document.getElementById("spiralNumber");le.addEventListener("input",e=>{y=parseFloat(e.target.value),ae.value=y,o("spiralCoeff",y),a?E():Y()});ae.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(y=t,t>=2&&t<=200&&(le.value=y),o("spiralCoeff",y),a?E():Y())});const ce=document.getElementById("maxNSlider"),ue=document.getElementById("maxNNumber");ce.addEventListener("input",e=>{p=parseInt(e.target.value),ue.value=p,o("maxN",p),a?E():Y()});ue.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=1&&t<=19e5&&!isNaN(t)&&(p=t,t>=2e4&&t<=19e4&&(ce.value=p),t>5e5&&console.warn(`Warning: Using ${t} points may impact performance`),o("maxN",p),a?E():Y())});const de=document.getElementById("clusterCountSlider"),me=document.getElementById("clusterCountNumber");de.addEventListener("input",e=>{v=parseInt(e.target.value),me.value=v,o("clusterCount",v),oe()});me.addEventListener("input",e=>{const t=parseInt(e.target.value);t>=0&&t<=2e3&&!isNaN(t)&&(v=t,t>=100&&t<=200&&(de.value=v),t>500&&console.warn(`Warning: Using ${t} clusters may impact performance`),o("clusterCount",v),oe())});const ge=document.getElementById("rotationSpeedSlider"),fe=document.getElementById("rotationSpeedNumber");ge.addEventListener("input",e=>{b=parseFloat(e.target.value),fe.value=b,o("rotationSpeed",b)});fe.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(b=t,t>=.1&&t<=5&&(ge.value=b),o("rotationSpeed",b))});const pe=document.getElementById("dotSizeSlider"),he=document.getElementById("dotSizeNumber");pe.addEventListener("input",e=>{I=parseFloat(e.target.value),he.value=I,o("dotSize",I)});he.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=20&&!isNaN(t)&&(I=t,t>=.5&&t<=10&&(pe.value=I),o("dotSize",I))});const ye=document.getElementById("primeSizeSlider"),ve=document.getElementById("primeSizeNumber");ye.addEventListener("input",e=>{x=parseFloat(e.target.value),ve.value=x,o("primeSize",x)});ve.addEventListener("input",e=>{const t=parseFloat(e.target.value);t>=.1&&t<=10&&!isNaN(t)&&(x=t,t>=.5&&t<=5&&(ye.value=x),o("primeSize",x))});document.addEventListener("keydown",e=>{e.key==="Escape"&&(M?te():ie.classList.contains("collapsed")||K.click()),(e.key==="F11"||e.key==="f"&&!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),ne()),e.key==="s"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),K.click()),e.key==="p"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),P.click()),e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),R.click()),e.key==="r"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),A.click()),e.key==="c"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),q.click()),e.key==="i"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),D.click())});window.addEventListener("resize",se);we();se();requestAnimationFrame(re);
